<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>













  
  
  
  
  
  
  
  
  
  
  
  
  
  <meta content="text/html; charset=ISO-8859-1" http-equiv="content-type">













  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <title>Linux Home Server HOWTO - Shared Address Book (LDAP)</title>
  <meta content="Miles Brennan" name="author">
</head>


<body>













<div style="text-align: center;"><span style="font-weight: bold;"><a name="top"></a>Linux
Home Server HOWTO</span><br>













</div>













<table style="width: 100%;" border="0" cellpadding="2" cellspacing="2">













  <tbody>













    <tr>













      <td style="width: 30%; text-align: left;"><a href="19-Network_File_System.html">Previous</a><br>













      </td>













      <td style="width: 40%; text-align: center;"><a href="index.html">Home</a>
      </td>













      <td style="width: 30%; text-align: right;"><a href="21-Virtual_Private_Networking.html">Next</a><br>













      </td>













    </tr>













  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>













<hr>
<h1>Chapter 20 - Shared Address
Book (LDAP)</h1>
















<table style="text-align: left; width: 100%;" border="0" cellpadding="1" cellspacing="1">












  <tbody>












    <tr>












      <td style="width: 140px;"><span style="font-weight: bold;">Version:</span></td>












      <td>- openldap-servers 2.3.19</td>












    </tr>












  
  
  
  
  
  
  
  
  
  
  
  <tr>
      <td style="width: 140px;"></td>
      <td>- phpLDAPadmin 1.0.1</td>
    </tr>
  </tbody>
</table>












<br>













<a href="#concepts">Initial Concepts</a><br>













<a href="#config">Basic
Configuration</a><br>













<a href="#addentries">Address
Book Entries</a><br>













<a href="#encryption">TLS Link Encryption</a><br>













<a href="#phpldapadmin">phpLDAPadmin
Web Administrator</a><br>













<a href="#clients">Email
Client Settings</a><br>













<br>













Many individuals throughout professional organisations will consider
their list of personal and professional contacts as one of their most
important assets. Similarly at home keeping our contact details of
friends, relatives and professional service providers like physicians
is also equally important, however maintaining that contact list across
several computers can be very time consuming; even frustrating if it is
lost.<br>













<br>













Using the Lightweight Directory Access Protocol (LDAP) we can configure
a centrally managed address book that can be shared by all the of
computer workstations throughout the network (for many large
organisations this is a fundamental design concept). A central (or
shared) address book allows easy management of all contact details, it
can be backed up and restored very easily, and it can also be made
available through a secure web interface so it can be accessed remotely
from where ever the user may be.<br>













<br>













This chapter will detail the procedures necessary to configure the
OpenLDAP (<a href="http://www.openldap.org">http://www.openldap.org</a>)
directory service that will provide the basis for our address book and
make it available to our network users. We will also look at populating
the address book and provide security access controls so that only
authenticated users can access the information.<br>













<br>













Not all email clients are able to write to the address book (although
reading is fine), this is normally due to the functionality of the
email client and not a problem with the directory service. Therefore,
we will also configure the web server with a web based administration
application which will allow full control of the address book; this
also allows the remote access if needed.<br>













<br>













The following list of man pages can provide further information to
assist with configuration or debugging requirements.












<br>
<br>













<table style="background-color: rgb(220, 220, 220); width: 100%; text-align: left;" border="1" cellpadding="2" cellspacing="2">













  <tbody>













    <tr style="font-family: monospace;">













      <td colspan="3" rowspan="1" style="background-color: rgb(255, 255, 255); font-weight: bold; width: 135px;">Man
Pages:












      </td>













    </tr>













    <tr>













      <td style="background-color: rgb(220, 220, 220); width: 135px; font-family: monospace;">ldap












      </td>













      <td style="background-color: rgb(220, 220, 220); width: 135px; font-family: monospace;">
      slapd</td>













      <td style="width: 630px; font-family: monospace;">slapcat</td>













    </tr>













    <tr>













      <td style="background-color: rgb(220, 220, 220); width: 135px; font-family: monospace;">ldap.conf












      </td>













      <td style="background-color: rgb(220, 220, 220); width: 135px; font-family: monospace;">slapd.conf</td>













      <td style="width: 630px; font-family: monospace;">slapadd</td>













    </tr>













    <tr>













      <td style="width: 135px; font-family: monospace;">ldapadd </td>













      <td style="width: 135px; font-family: monospace;">slapd.access</td>













      <td style="width: 630px; font-family: monospace;">slappasswd</td>













    </tr>













    <tr>













      <td style="width: 135px; font-family: monospace;">ldapsearch </td>













      <td style="width: 135px; font-family: monospace;">slaptest</td>













      <td style="width: 630px; font-family: monospace;">ldif</td>













    </tr>













  
  
  
  
  
  






  
  
  
  
  
  
  
  </tbody>
</table>













<br>













<h2><a name="concepts"></a><a href="#top">Initial Concepts</a></h2>



















The shared address book is being configured using the LDAP directory
services which basically stores different types of information and
objects in a database and these entries are accessible using its own
directory architecture (X.500 standard).<br>













<br>













The naming conventions used to
traverse this system can be extremely complex for new users to grasp,
so the following table has been provided as an example of what these
objects are and the names we are going to use in referencing them.<br>













<br>













<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">













  <tbody>













    <tr>













      <td style="font-weight: bold; background-color: rgb(255, 255, 255); width: 280px;">Description<br>













      </td>













      <td style="font-weight: bold; background-color: rgb(255, 255, 255); width: 616px;">String
Value (DN)<br>













      </td>













    </tr>













    <tr>













      <td style="width: 280px;"><tt>Base
Domain<br>













      </tt> </td>













      <td style="width: 616px;"><tt>dc=example,dc=com</tt> </td>













    </tr>













    <tr>













      <td style="width: 280px;"><tt>Admin
User<br>













      </tt></td>













      <td style="width: 616px;"><tt>cn=Manager,dc=example,dc=com</tt></td>













    </tr>













    <tr>













      <td style="width: 280px;">Authorised
users located here<br>













      </td>













      <td style="width: 616px;"><tt>ou=users,dc=example,dc=com</tt></td>













    </tr>













    <tr>













      <td style="width: 280px;"><tt>Authorised
user account (example)<br>













      </tt> </td>













      <td style="width: 616px;"><tt>uid=alice,ou=users,dc=example,dc=com</tt></td>













    </tr>













    <tr>













      <td style="width: 280px;"><tt>Address
book entries located here<br>













Also used by client as "Search Base"<br>













      </tt></td>













      <td style="width: 616px;"><tt>ou=addressbook,dc=example,dc=com</tt></td>













    </tr>













    <tr>













      <td style="width: 280px;"><tt>Address
book entry (example)<br>













      </tt> </td>













      <td style="width: 616px;"><tt>cn=Tom
Thumb,ou=addressbook,dc=example,dc=com</tt></td>













    </tr>













  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>













<br>













The following table explains some of the basic acronyms used throughout
the directory, there are many more than this that go to make up the
naming conventions, however these are the only ones we will be
concerned with.<br>













<br>













<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">













  <tbody>













    <tr>













      <td style="font-weight: bold; background-color: rgb(255, 255, 255); width: 100px;">String<br>













      </td>













      <td style="font-weight: bold; background-color: rgb(255, 255, 255); width: 796px;">Attribute
Type<br>













      </td>













    </tr>













    <tr>













      <td>dn<br>













      </td>













      <td>Distinguished Name<br>













      </td>













    </tr>













    <tr>













      <td style="width: 100px;">cn<br>













      </td>













      <td style="width: 796px;">Common
Name<br>













      </td>













    </tr>













    <tr>













      <td style="width: 100px;">o<br>













      </td>













      <td style="width: 796px;">Organisational
Name</td>













    </tr>













    <tr>













      <td style="width: 100px;">ou<br>













      </td>













      <td style="width: 796px;">Organisational
Unit Name</td>













    </tr>













    <tr>













      <td style="width: 100px;">dc<br>













      </td>













      <td style="width: 796px;">Domain
Component<br>













      </td>













    </tr>













    <tr>













      <td style="width: 100px;">uid<br>













      </td>













      <td style="width: 796px;">User
Identification<br>













      </td>













    </tr>













  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>













<br>













<table style="width: 100%; text-align: left;" border="1" cellpadding="2" cellspacing="2">













  <tbody>













    <tr>













      <td style="vertical-align: middle; text-align: center; width: 52px;"><img style="width: 24px; height: 24px;" alt="Caution !!" src="images/caution.gif"></td>













      <td>Do not confuse the X.500 naming scheme used in LDAP with the
email addresses of your contacts, they are totally separate details.
This
will become clear further on.<br>













      </td>













    </tr>













  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>













<br>













Everything inside the directory has a distinguished name (dn) this is
what makes each entry unique from the others and also provides a means
to easily reference the object. Viewing the top table, the DN for the
manager account is "<tt>cn=Manager,dc=example,dc=com"</tt>, while all
of the address book entries are contained in the DN of <tt>"</tt><tt>ou=addressbook,dc=example,dc=com".</tt><br>













<br>













The following table displays valid examples of how domains are
expressed using the X.500 naming scheme. <br>













<br>













<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">













  <tbody>













    <tr>













      <td style="font-weight: bold; background-color: rgb(255, 255, 255); width: 280px;">Example
Domain Names<br>













      </td>













      <td style="font-weight: bold; background-color: rgb(255, 255, 255); width: 616px;">String
Value<br>













      </td>













    </tr>













    <tr>













      <td style="width: 280px;"><tt>home.lan<br>













      </tt></td>













      <td style="width: 616px;"><tt>dc=home,dc=lan</tt> </td>













    </tr>













    <tr>













      <td style="width: 280px;"><tt>example.com</tt></td>













      <td style="width: 616px;"><tt>dc=example,dc=com</tt></td>













    </tr>













    <tr>













      <td><tt>example.org</tt></td>













      <td><tt>dc=example,dc=org</tt></td>













    </tr>













    <tr>













      <td style="width: 280px;">domain.org.au<br>













      </td>













      <td style="width: 616px;"><tt>dc=domain,</tt><tt>dc=org</tt><tt>,dc=au</tt></td>













    </tr>













    <tr>













      <td style="width: 280px;">sub.domain.org.au</td>













      <td style="width: 616px;"><tt>dc=sub,dc=domain,</tt><tt>dc=org</tt><tt>,dc=au</tt></td>













    </tr>













    <tr>













      <td style="width: 280px;">more.sub.domain.org.au</td>













      <td style="width: 616px;"><tt>dc=more,dc=sub,dc=domain,</tt><tt>dc=org</tt><tt>,dc=au</tt></td>













    </tr>













  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>













<br>













<table style="width: 100%; text-align: left;" border="1" cellpadding="2" cellspacing="2">













  <tbody>













    <tr>













      <td style="vertical-align: middle; text-align: center; width: 52px;"><img style="width: 24px; height: 24px;" alt="Note !!" src="images/note.gif"></td>













      <td>If
the LDAP server is simply being configured as a shared address book and
not for any real networking requirement, then it is acceptable to use a
simple domain similar to "home.lan"<br>













      </td>













    </tr>













  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>













<br>













<h2><a name="config"></a><a href="#top">Basic
Configuration</a></h2>













The OpenLDAP package contains a server and client application. The
client application will be used to query the server and insert/update
information during the configuration, so it is necessary to configure
this as well as the server.<br>













<br>













The configuration that we need is very simple, however good house
keeping means making backups before adjusting the configuration file.<br>













<br>













<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">













  <tbody>













    <tr>













      <td>[bash]# <span style="font-weight: bold;">cp
/etc/openldap/ldap.conf /etc/openldap/ldap.conf.original</span><br>













[bash]# <span style="font-weight: bold;">vi /etc/openldap/ldap.conf</span><br>













      </td>













    </tr>













  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>













<br>













The following entry is really all that is needed for the client. It
identifies where the server is located, and which part of the directory
tree to query.<br>













<br>













<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">













  <tbody>













    <tr>













      <td><tt>URI
ldap://galaxy.example.com:389<br>













BASE dc=example,dc=com<br>













TLS_REQCERT allow<br>













      </tt> </td>













    </tr>













  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>













<br>













The server can be configured with a built-in administrator account that
has global root privileges, it is necessary to store the password for
the root account inside the server configuration file. The "<span style="font-family: monospace;">slappasswd</span>"
application allows passwords to be encrypted (or hashed) which stops
unauthorised users from viewing the password, or intercepting a
plaintext password while it is being transmitted over the network.<br>













<br>













Create a suitable password for the root account so it can be placed
into the configuration file.<br>













<br>













<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">













  <tbody>













    <tr>













      <td><tt>[bash]#
      <span style="font-weight: bold;">slappasswd</span></tt></td>













    </tr>













    <tr>













      <td>{SSHA}RZmBkCh3WwEMNhdANh/l3OynzHSifPzF </td>













    </tr>













  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>













<br>













The LDAP server is called slapd (Stand-Alone LDAP Daemon), lets backup
the configuration file before making adjustments.<br>













<br>













<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">













  <tbody>













    <tr>













      <td>[bash]# <span style="font-weight: bold;">cp
/etc/openldap/slapd.conf /etc/openldap/slapd.conf.original</span><br>













[bash]# <span style="font-weight: bold;">vi /etc/openldap/slapd.conf</span><br>













      </td>













    </tr>













  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>













<br>













The following slapd.conf file contains the basic configurations
required to establish a shared address book on a secure network,
however there are no access controls yet defined; security is covered
later on. The encrypted root password should be substituted where
necessary.<br>













<br>













The five lines that are commented below are not needed to configure our
simple address book. However they be needed if you wish to advance your
LDAP requirements so they have been left as comments only; they
may be removed if need be.<br>













<br>













<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">













  <tbody>













    <tr>













      <td><tt>include&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
/etc/openldap/schema/core.schema<br>













include&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
/etc/openldap/schema/cosine.schema<br>













include&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
/etc/openldap/schema/inetorgperson.schema<br>













#include&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
/etc/openldap/schema/nis.schema<br>













      <br>







pidfile&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /var/run/openldap/slapd.pid<br>







argsfile&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /var/run/openldap/slapd.args<br>







      <br>













#############################################################<br>













      <br>













database&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
bdb<br>













suffix&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
"dc=example,dc=com"<br>













rootdn&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
"cn=Manager,dc=example,dc=com"<br>













rootpw&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="font-weight: bold;">{SSHA}RZmBkCh3WwEMNhdANh/l3OynzHSifPzF &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: rgb(255, 0, 0);">&lt;-- insert generated root password here</span></span><br>













      <br>













directory&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
/var/lib/ldap<br>













      <br>
index
objectClass&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
eq,pres<br>













#index
ou,cn,mail,surname,givenname&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
eq,pres,sub<br>













#index uidNumber,gidNumber,loginShell&nbsp;&nbsp;&nbsp;
eq,pres<br>
#index
uid,memberUid&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
eq,pres,sub<br>













#index
nisMapName,nisMapEntry&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
eq,pres,sub<br>
      <br>
      </tt># DB_CONFIG Settings - For SleepyCat Berkeley DB<br>
dbconfig set_cachesize 0 10485760 0<br>







      dbconfig set_lg_regionmax 262144<br>
dbconfig 






set_lg_bsize 2097152<br>
      </td>













    </tr>













  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>













<br>







<br>













<table style="width: 100%; text-align: left;" border="1" cellpadding="2" cellspacing="2">













  <tbody>













    <tr>













      <td style="vertical-align: middle; text-align: center; width: 52px;"><img style="width: 24px; height: 24px;" alt="Note !!" src="images/note.gif"></td>













      <td>It is possible to run
multiple databases using the one OpenLDAP server, however we are only
concerned with one for the time being. Consult the documentation for
further details if needed. </td>













    </tr>













  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>













<br>













After the configuration has been adjusted it can be checked before it
is implemented. Any errors should be fixed before restarting the server.<br>













<br>













<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">













  <tbody>













    <tr>













      <td>[bash]# <span style="font-weight: bold;">/etc/init.d/ldap configtest</span><br>













      </td>













    </tr>













  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>













<br>













The LDAP service should now be set at the appropriate runlevels and
checked to ensure they are set correctly.<br>













<br>













<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">













  <tbody>













    <tr>













      <td>[bash]# <span style="font-weight: bold;">chkconfig
--level 345 ldap on</span><br>













[bash]# <span style="font-weight: bold;">chkconfig --list ldap</span><br>













      </td>













    </tr>













  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>













<br>













The service can now be started with the following command.<br>













<br>













<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">













  <tbody>













    <tr>













      <td>[bash]# <span style="font-weight: bold;">/etc/init.d/ldap
restart</span><span style="font-weight: bold;"><br>
      </span> </td>













    </tr>













  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>













<br>













<h2><a href="#top"><span style="font-weight: bold;"></span></a><a name="addentries"></a><a href="#top">Address
Book Entries<br>













</a></h2>













Information can be imported and exported into an LDAP directory service
using the LDAP Data Interchange Format (LDIF) as defined in <a href="http://www.ietf.org/rfc/rfc2849.txt">RFC2849</a>. An LDIF file
specifies the contents of a directory entry in a human readable text
format, this allows quick manipulation of a file to re-import similar
entries into the directory.<br>













<br>













Now that the LDAP server has been configured and is running, we can
conduct a simple search of the naming context to see our directory
information before we start to import our entries. The "namingContexts"
should be similar to the example below.<br>













<br>













<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">













  <tbody>













    <tr>













      <td><tt>[bash]# </tt><tt style="font-weight: bold;">ldapsearch -x -b '' -s base
'(objectclass=*)' namingContexts</tt></td>













    </tr>













    <tr>













      <td># extended LDIF<br>













#<br>













# LDAPv3<br>













# base &lt;&gt; with scope base<br>













# filter: (objectclass=*)<br>













# requesting: namingContexts<br>













      <br>













dn:<br>













      <span style="font-weight: bold;">namingContexts:
dc=example,dc=com</span><br>













      <br>













# search result<br>













search: 2<br>













result: 0 Success<br>













      <br>













# numResponses: 2<br>













# numEntries: 1<br>













      </td>













    </tr>













  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>













<br>













The following LDIF file will create the hierarchical directory service
structure that we will be using for our address book. The first entry
is that of the base directory and the second entry is for the Manager's
(administrator) account. The last two entries are the two
organisational units that we will use to store the authorised users
(for adding security later) and the address book entries.<br>













<br>













The bolded entries should be changed to suit your configuration
requirements.<br>













<br>













<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">













  <tbody>













    <tr>













      <td>[bash]# <span style="font-weight: bold;">vi
/etc/openldap/addressbook.ldif</span><br>













      </td>













    </tr>













    <tr>













      <td>dn: <span style="font-weight: bold;">dc=example,dc=com</span><br>













objectclass: dcObject<br>













objectclass: organization<br>













o: Home LDAP Server<br>













dc: <span style="font-weight: bold;">example</span><br>













      <br>













dn: cn=Manager,<span style="font-weight: bold;">dc=example,dc=com</span><br>













objectclass: organizationalRole<br>













cn: Manager<br>













      <br>













dn: ou=users,<span style="font-weight: bold;">dc=example,dc=com</span><br>













ou: users<br>













objectClass: top<br>













objectClass: organizationalUnit<br>













      <br>













dn: ou=addressbook,<span style="font-weight: bold;">dc=example,dc=com</span><br>













ou: addressbook<br>













objectClass: top<br>













objectClass: organizationalUnit<br>













      </td>













    </tr>













  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>













<br>













Using the "ldapadd" command we can enter the LDIF contents into the
server, creating our initial directory scheme.<br>













<br>













<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">













  <tbody>













    <tr>













      <td>[bash]# <tt style="font-weight: bold;">ldapadd
-x -D '</tt><tt style="font-weight: bold;">cn=Manager,</tt><span style="font-weight: bold;">dc=example,dc=com</span><tt style="font-weight: bold;">'
-W -f </tt><span style="font-weight: bold;">/etc/openldap/</span><tt style="font-weight: bold;">addressbook.ldif</tt></td>













    </tr>













    <tr>













      <td>Enter LDAP Password:<br>













adding new entry "dc=example,dc=com"<br>













adding new entry "cn=Manager,dc=example,dc=com"<br>













adding new entry "ou=users,dc=example,dc=com"<br>













adding new entry "ou=addressbook,dc=example,dc=com"<br>













      </td>













    </tr>













  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>













<br>













The following LDAP search is requesting a listing of all entries
starting from the base "dc=example,dc=com". This should return all of
the entries that where added in the previous step.<br>













<br>













<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">













  <tbody>













    <tr>













      <td>[bash]# <tt style="font-weight: bold;">ldapsearch
-x -b '</tt><span style="font-weight: bold;">dc=example,dc=com</span><tt style="font-weight: bold;">'
'(objectclass=*)'</tt><br>













      </td>













    </tr>













    <tr>













      <td># example.com<br>













dn: dc=example,dc=com<br>













objectClass: top<br>













objectClass: dcObject<br>













objectClass: organization<br>













o: Home LDAP Network<br>













dc: example<br>













      <br>













# Manager, example.com<br>













dn: cn=Manager,dc=example,dc=com<br>













objectClass: organizationalRole<br>













cn: Manager<br>













      <br>













# users, example.com<br>













dn: ou=users,dc=example,dc=com<br>













ou: users<br>













objectClass: top<br>













objectClass: organizationalUnit<br>













      <br>













# addressbook, example.com<br>













dn: ou=addressbook,dc=example,dc=com<br>













ou: addressbook<br>













objectClass: top<br>













objectClass: organizationalUnit<br>













      </td>













    </tr>













  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>













<br>













Now that we have defined and imported our directory scheme, we are able
to create user entries to populate the addressbook. The following is a
simple example LDIF entry for a contact.<br>













<br>













The first line (dn:) designates where about in the directory the entry
will belong when its imported, this should be changed to suit your
needs.<br>













<br>













<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">













  <tbody>













    <tr>













      <td>[bash]# <span style="font-weight: bold;">vi
newcontact.ldif</span><br>













      </td>













    </tr>













    <tr>













      <td>
      
      
      
      
      
      
      
      
      
      
      
      
      dn:cn=Tom Thumb,ou=addressbook,<span style="font-weight: bold;">dc=example,dc=com</span><br>
      <code></code>cn: Tom Thumb<br>
gn: Tom<br>
sn: Thumb<br>
o: Home<br>
l: Brisbane<br>
street: 12 Banana Ave<br>
      <code></code><code>st: QLD<br>
      </code>postalCode: 4100<br>
      <code></code><code>pager: 5555 1111</code><br>
      <code>homePhone:</code> 5555 1234<br>
telephoneNumber: 5555 1235<br>
      <code></code>facsimileTelephoneNumber: 5555 1236<br>
mobile: 0400 123 123<br>
mail: tom.thumb@somedomain.com<br>
objectClass: top<br>
objectClass: inetOrgPerson<br>













      </td>













    </tr>













  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>













<br>













The contents of the LDIF file can be added into the directory service
using the "ldapadd" command below.<br>













<br>













The standard access controls for the server defines that everyone can
read the directory entries, but only the manager (administrator) can
write to the directories. To add the LDIF file the manager is
authenicating on the command line with the "<tt style="font-family: monospace;">-D '</tt><tt style="font-family: monospace;">cn=Manager,</tt><span style="font-family: monospace;">dc=example,dc=com</span><tt>'
-W" string.</tt><br>













<br>













<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">













  <tbody>













    <tr>













      <td>[bash]# <tt style="font-weight: bold;">ldapadd
-x -D '</tt><tt style="font-weight: bold;">cn=Manager,</tt><span style="font-weight: bold;">dc=example,dc=com</span><tt style="font-weight: bold;">'
-W -f </tt><tt style="font-weight: bold;">newcontact.ldif</tt></td>













    </tr>













    <tr>













      <td>Enter LDAP Password:<br>













adding new entry "cn=Tom Thumb,ou=addressbook,dc=example,dc=com"<br>













      </td>













    </tr>













  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>













<br>













Now that the first entry has been successfully added to the directory
server, the file can be copied so more entries can be added.
Alternatively, extra entries can be added to the same file ensuring
that a blank line is used to separate each different entry.<br>













<br>













<h2><a name="encryption"></a><a href="#top">TLS Link Encryption</a><a href="#top">









</a></h2>
The standard security settings for the LDAP server allows everyone to
connect (bind) to the server and read the entire directory contents,
while only the administrative account can make changes or add new
entries. For your small home network you may find this entirely
suitable in its current format, however the following details will
provide some extra security configurations to make it less accessible,
this is also important if you wish to access your home server from
beyond your home network.<br>













<br>













The access controls are defined within the servers main configuration
file.<br>













<br>













<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">













  <tbody>













    <tr>













      <td>[bash]# <span style="font-weight: bold;">vi
/etc/openldap/slapd.conf</span><br>













      </td>













    </tr>













  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>













<br>













The following details are typical of the security settings that you may
consider implementing. The first section details any link encryption
using TLS/SSL and it also enforces which actions can be done on the
server depending on the level of link security that has been
implemented.<br>













<br>













The second section details the access controls based on the users
authentication and basic anonymous access. The default access controls
(below) have been defined to deny everyone access, however people are
allowed to bind to the server to authenticate. All authenticated users
are allowed to change their own details, and all of the entries in the
"<span style="font-family: monospace;">ou=addressbook,dc=example,dc=com</span>"
directory; anonymous access it disallowed.<br>













<br>













<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">













  <tbody>













    <tr>













      <td><tt>TLSCACertificateFile /etc/pki/tls/certs/ca-bundle.crt<br>






TLSCertificateFile /etc/pki/tls/certs/slapd.pem<br>






TLSCertificateKeyFile /etc/pki/tls/certs/slapd.pem<br>






security ssf=1 update_ssf=112 simple_bind=64<br>













      <br>
      </tt>disallow bind_anon<br>
access to *<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; by self write<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; by anonymous auth<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; by users read<br>
access to dn.subtree="ou=addressbook,dc=example,dc=com"<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; by users write<br>
      </td>
    </tr>
  </tbody>
</table>
<br>













<table style="width: 100%; text-align: left;" border="1" cellpadding="2" cellspacing="2">













  <tbody>













    <tr>













      <td style="vertical-align: middle; text-align: center; width: 52px;"><img style="width: 24px; height: 24px;" alt="Note !!" src="images/note.gif"></td>













      <td>The term "users" defines those people that have successfully
authenticated with the server.<br>













      </td>













    </tr>













  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>













<br>
You will need to create an SSL certificate for use with your server,
the following code will create a self-signed certificate which is good
enough for our requirements.<br>






<br>













<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">













  <tbody>













    <tr>













      <td><tt>[bash]#&nbsp;</tt><span style="font-weight: bold;">cd&nbsp;/etc/pki/tls/certs<br>






      </span><tt>[bash]# <span style="font-weight: bold;">make slapd.pem</span></tt><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span></td>













    </tr>













  
  
  
  
  
  
  <tr>






      <td>Country Name (2 letter code) [GB]:<span style="color: rgb(255, 0, 0); font-weight: bold;">AU</span><br>















State or Province Name (full name) [Berkshire]:<span style="color: rgb(255, 0, 0); font-weight: bold;">QLD</span><br>















Locality Name (eg, city) [Newbury]:<span style="color: rgb(255, 0, 0); font-weight: bold;">Brisbane</span><br>















Organization Name (eg, company) [My Company Ltd]:<span style="font-weight: bold; color: rgb(255, 0, 0);">Miles Brennan</span><span style="font-weight: bold; color: rgb(255, 0, 0);"></span><br>















Organizational Unit Name (eg, section) []:<span style="font-weight: bold; color: rgb(255, 0, 0);"></span><span style="font-weight: bold; color: rgb(255, 0, 0);">Home Linux Server</span><span style="font-weight: bold; color: rgb(255, 0, 0);"></span><br>















Common Name (eg, your name or your server's hostname) []:<span style="font-weight: bold; color: rgb(255, 0, 0);">galaxy.example.com</span><br>















Email Address []:<span style="font-weight: bold; color: rgb(255, 0, 0);">sysadmin@example.com</span></td>






    </tr>






  
  
  
  
  
  
  </tbody>
</table>












<br>
The ownership and permissions for the self-signed certificate need to
be adjusted slighty so the basic "LDAP" user account can read the
certificate details.<br>






<br>













<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">













  <tbody>













    <tr>













      <td><tt>[bash]# <span style="font-weight: bold;">chown root.ldap /etc/pki/tls/certs/slapd.pem</span></tt><br>






      <tt>[bash]# <span style="font-weight: bold;">chmod 640 /etc/pki/tls/certs/slapd.pem</span></tt></td>













    </tr>













  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>












<br>
Now that the server has been configured for TLS/SSL, the LDAP client
also needs to be configured for TLS/SSL otherwise they will not be able
to communicate.<br>






<br>













<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">













  <tbody>













    <tr>













      <td><tt>[bash]# <span style="font-family: mon;"><span style="font-weight: bold;">vi /etc/openldap/ldap.conf</span></span><span style="font-weight: bold;"></span></tt><tt></tt> </td>













    </tr>













  
  
  
  
  
  
  <tr>






      <td><tt>URI
ldaps://www.example.com:636<br>













BASE dc=example,dc=com<br>













TLS_REQCERT demand &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="font-weight: bold; color: rgb(255, 0, 0);">&lt;-- see warning below, may need to be "allow"</span><br>






TLS_CACERTDIR</tt><tt> /etc/pki/tls/certs/<br>






      </tt><tt>TLS_CACERT /etc/pki/tls/certs/ca-bundle.crt<br>






TLS_CRLCHECK peer</tt></td>






    </tr>






  
  
  
  
  
  
  </tbody>
</table>












<br>













<table style="width: 100%; text-align: left;" border="1" cellpadding="2" cellspacing="2">













  <tbody>













    <tr>













      <td style="vertical-align: middle; text-align: center; width: 52px;"><img style="width: 24px; height: 24px;" alt="Warning !!" src="images/warning.gif"></td>













      <td>Refer to <span style="font-family: monospace; font-weight: bold;">"man ldap.conf"</span> and <span style="font-family: monospace; font-weight: bold;">"man slapd.conf"</span>
for the exact meanings of the TLS options. Incorrect settings when
working with a <span style="font-weight: bold;">"self signed"</span> PEM certificate may prevent your LDAP
client from successfully connecting to your SLAPD server.<br>













      </td>













    </tr>













  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>













<br>






An access control list may be prone to user syntax errors and will not
be accepted by the LDAP server, so the configuration should be tested
before it is loaded.<br>













<br>













<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">













  <tbody>













    <tr>













      <td><tt>[bash]#&nbsp;<span style="font-weight: bold;"></span></tt><tt><span style="font-weight: bold;">/etc/init.d/ldap configtest</span></tt></td>













    </tr>













  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>













<br>













If the configuration passes integrity testing, the server can be
restarted.<br>













<br>













<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">













  <tbody>













    <tr>













      <td><tt>[bash]# <span style="font-weight: bold;">/etc/init.d/ldap restart</span></tt> </td>













    </tr>













  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>













<br>













The new security access controls now prevent unauthorised access to the
directory service, so simple user objects must be prepared that will
allow people to authenticate with the server.<br>













<br>













The user objects will be imported into the LDAP server using an LDIF
file. Remember that everything in an LDIF file is human readable so
plain text passwords are a VERY BAD idea, especially if you are
following this guide for an organisation; no plain text passwords please.<br>













<br>













The slappasswd application can be used to create a hashed value of a
users password, these are saved to store in a text file. This does not
mean they are completely safe, it just means they can not be easily
read. An attacker can still subject the password value to a brute force
attack, but it would take them an awfully long time. Physical security
is still important.<br>













<br>













<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">













  <tbody>













    <tr>













      <td>[bash]# <span style="font-weight: bold;">slappasswd</span></td>













    </tr>













    <tr>













      <td>{SSHA}RZmBkCh3WwEMNhdANh/l3OynzHSifPzF </td>













    </tr>













  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>













<br>













The default algorithm for the hashed password is SSHA, this can be
changed at the command line to other formats; the default type (SSHA)
is recommended.<br>













<br>













<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">













  <tbody>













    <tr>













      <td>[bash]# <span style="font-weight: bold;">slappasswd -h
{MD5}</span></td>













    </tr>













    <tr>













      <td>{MD5}poocSzW4TMBN3fOtmVOQHg==<br>













      </td>













    </tr>













  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>













<br>













The basic user object can now be created and imported into the LDAP
server. This file uses the "UID" (User ID) string to distinguish the object and
the contents are all that we need to create a basic authentication
mechanism.<br>













<br>













It should also be noted that this object is stored in the "users"
organisational unit, which is located outside of the address book
directory.<br>













<br>













<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">













  <tbody>













    <tr>













      <td>[bash]# <span style="font-weight: bold;">vi
useraccount.ldif</span> </td>













    </tr>













    <tr>













      <td> dn:<span style="font-weight: bold;">uid=alice,ou=users,dc=example,dc=com</span><br>













uid: alice<br>













userPassword: {MD5}poocSzW4TMBN3fOtmVOQHg==<br>













objectClass: top<br>













objectClass: account<br>













objectClass: simpleSecurityObject </td>













    </tr>













  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>













<br>













The user account can now be entered into the LDAP server.<br>













<br>













<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">













  <tbody>













    <tr>













      <td>[bash]# <tt style="font-weight: bold;">ldapadd
-x -D '</tt><tt style="font-weight: bold;">cn=Manager,</tt><span style="font-weight: bold;">dc=example,dc=com</span><tt style="font-weight: bold;">'
-W -f </tt><span style="font-weight: bold;">useraccount.ldif</span></td>













    </tr>













    <tr>













      <td>Enter LDAP Password:<br>













adding new entry "uid=alice,ou=users,dc=example,dc=com"<br>













      </td>













    </tr>













  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>













<br>













<table style="width: 100%; text-align: left;" border="1" cellpadding="2" cellspacing="2">













  <tbody>













    <tr>













      <td style="vertical-align: middle; text-align: center; width: 52px;"><img style="width: 25px; height: 24px;" alt="Hint !!" src="images/hint.gif"></td>













      <td>For Alice to authenticate to the server, she needs to pass "<span style="font-family: monospace;">uid=alice,ou=users,dc=example,dc=com</span>"
as her username along with the the plain text value of her password,
the hashed value is only for storage purposes. </td>













    </tr>













  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>













<br>













<h3>Backing Up The Database</h3>













The OpenLDAP server allows for easy importing and exporting of
directory entries using the LDIF format, this makes it extremely easy
to extract the complete contents of the database for backup purposes.<br>













<br>













The service should be stopped before extracting or importing the
directory service listing.<br>













<br>













<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">













  <tbody>













    <tr>













      <td>[bash]# <span style="font-weight: bold;">/etc/init.d/</span><tt style="font-weight: bold;">ldap stop</tt></td>













    </tr>













  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>













<br>













<table style="width: 100%; text-align: left;" border="1" cellpadding="2" cellspacing="2">













  <tbody>













    <tr>













      <td style="vertical-align: middle; text-align: center; width: 52px;"><img style="width: 24px; height: 24px;" alt="Caution !!" src="images/caution.gif"></td>













      <td>The LDAP server should be stopped before executing the "<span style="font-family: monospace;">slapcat</span>" or "<span style="font-family: monospace;">slapadd</span>" commands. This
prevents the possibility of data corruption and ensures database
integrity is maintained.<br>













      </td>













    </tr>













  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>













<br>













The following "slapcat" command will extract the entire database
contents into the "backup_slapd.ldif" file. This file should be stored
in a save place, particularly if password information is contained in
the file.<br>













<br>













<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">













  <tbody>













    <tr>













      <td>[bash]# <span style="font-weight: bold;">slapcat -vl
/etc/openldap/backup_slapd.ldif</span></td>













    </tr>













  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>













<br>













The contents of the stored "backup_slapd.ldif" file can be imported
back into the LDAP server using the following command. This is a quick
and easy method to rebuild your entire address book after a system
rebuild.<br>













<br>













<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">













  <tbody>













    <tr>













      <td>[bash]# <span style="font-weight: bold;">slapadd -vl
/etc/openldap/backup_slapd.ldif</span><br>













      </td>













    </tr>













  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>













<br>













If an LDIF restore is being done on a new LDAP server, there is a
possibility that the database directory has not been configured
correctly for the ldap user account. If this is the case then the
server may not start correctly because the file permissions are
incorrect.<br>













<br>













To restore the file permissions on a newly restored LDAP database, use
the following command to grant user and group ownership to the "ldap"
user account. This may be different for each Linux distribution, please
refer to your configuration details first.<br>













<br>













<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">













  <tbody>













    <tr>













      <td>[bash]# <span style="font-weight: bold;">chown ldap.ldap /var/lib/ldap/*</span><br>













      </td>













    </tr>













  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>













<br>













The service can now be started to access the directory services.<br>













<br>













<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">













  <tbody>













    <tr>













      <td>[bash]# <span style="font-weight: bold;">/etc/init.d/ldap
restart</span><br>













      </td>













    </tr>













  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>













<br>













<h2><a name="phpldapadmin"></a><a href="#top">phpLDAPadmin
Web Administrator</a></h2>













There are many different email clients available today that are capable
of using an LDAP server as a central address book, however even less of
these clients are able to write new contacts details to the server or
even make changes to an existing entry (this is not a server problem).
One of the easiest mays to interface and administer the shared address
book is by using a web based application installed on the web server;
this provides easy management and remote access to the address book.<br>













<br>













phpLDAPadmin (<a href="http://phpldapadmin.sourceforge.net/">http://phpldapadmin.sourceforge.net/</a>)
is a PHP based web application designed specifically to allow remote
management of an LDAP server by using a simple web browser. Although
this package is covered under the open source license there is a small
fee for "commercial" users, but its still totally free for home use.<br>













<br>













The package firstly needs to be downloaded from the phpLDAPadmin site
and saved somewhere on the server; the package is available for
download as a 'tarball' (a .tar.gz file). Use the following commands to
extract the archive into the "/var/www" directory, remember to replace <span style="font-weight: bold; text-decoration: underline;">?.?.?</span>
with the version number you have downloaded.<br>













<br>













<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">













  <tbody>













    <tr>













      <td>[bash]# <span style="font-weight: bold;">tar -xzvf
phpldapadmin-</span><span style="text-decoration: underline; font-weight: bold;">?.?.?</span><span style="font-weight: bold;">.tar.gz
-C /var/www/</span><br>













[bash]# <span style="font-weight: bold;">chown -R root.root /var/www/phpldapadmin-<span style="text-decoration: underline;">?.?.?</span>/</span><span style="font-weight: bold; text-decoration: underline;"></span> </td>













    </tr>













  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>













<br>













The application has now been extracted and needs to be configured with
the details of the local LDAP server. Normally there is only an example
configuration file available in the package, this should be copied over
as the main configuration file, then adjusted to suit your needs.<br>













<br>













When when configured the Apache web server a few chapters ago, we
created an SSL
certificate and used the rewrite module to force SSL connections. It is
recommended that SSL also be forced on the phpLDAPamin application so
that any logon details and database queries are executed
confidentially.<br>













<br>













<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">













  <tbody>













    <tr>













      <td>[bash]# <span style="font-weight: bold;">cp
/var/www/phpldapadmin-<span style="text-decoration: underline;">?.?.?</span>/config/config.php.example
/var/www/phpldapadmin-<span style="text-decoration: underline;">?.?.?</span>/config/config.php</span><span style="text-decoration: underline;"></span> </td>













    </tr>













  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>













<br>













The following details in the configuration file are the basic
requirements needed for simple LDAP access and administration by the
web application. There are further details which can be configured, but
not needed for simple address book management; you may configure these
further options if you would like to use them though.<br>













<br>













<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">













  <tbody>













    <tr>













      <td>[bash]# <span style="font-weight: bold;">vi
/var/www/phpldapadmin-<span style="text-decoration: underline;">?.?.?</span>/config.php</span></td>













    </tr>













    <tr>













      <td>&lt;?php<br>






      <br>






//$config-&gt;custom-&gt;debug['level'] = 255;<br>






//$config-&gt;custom-&gt;debug['file'] = '/tmp/pla_debug.log';<br>






      <br>






/*********************************************/<br>






/* Define your LDAP servers in this section&nbsp; */<br>






/*********************************************/<br>






      <br>






$i=0;<br>






$ldapservers = new LDAPServers;<br>






$ldapservers-&gt;SetValue($i,'server','name','My LDAP Server');<br>






$ldapservers-&gt;SetValue($i,'server','host','127.0.0.1');<br>






$ldapservers-&gt;SetValue($i,'server','port','389');<br>






$ldapservers-&gt;SetValue($i,'server','base',array('dc=example,dc=com'));<br>






$ldapservers-&gt;SetValue($i,'server','auth_type','config');<br>






$ldapservers-&gt;SetValue($i,'login','dn','cn=Manager,dc=example,dc=com');<br>






$ldapservers-&gt;SetValue($i,'login','pass','<span style="font-weight: bold; color: rgb(255, 0, 0);">password</span>'); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="font-weight: bold; color: rgb(255, 0, 0);">&lt;-- set your Manager password here</span><span style="font-weight: bold; color: rgb(255, 0, 0);"></span><br>






$ldapservers-&gt;SetValue($i,'server','tls',<span style="font-weight: bold; color: rgb(255, 0, 0);">true</span>); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="font-weight: bold; color: rgb(255, 0, 0);">&lt;-- set to false if not using SSL certs</span><br>






      <br>






?&gt;<br>













      </td>













    </tr>













  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>













<br>













The archive for the phpLDAPadmin application was originally extracted
into the <span style="font-family: monospace; font-weight: bold;">"/var/www/phpldapadmin"</span>,
while the Apache web server has its <span style="font-family: monospace; font-weight: bold;">"DocumentRoot"</span>
directive set to <span style="font-weight: bold; font-family: monospace;">"/var/www/html"</span>
which means the
phpLDAPadmin application is located outside of the <span style="font-family: monospace; font-weight: bold;">"DocumentRoot"</span>
and the contents
are not yet accessible to the web server.<br>













<br>













We can create a configuration file for the phpLDAPadmin application so
Apache can access the resources that are required. The configuration
below is using the <span style="font-family: monospace; font-weight: bold;">AuthType</span>
directive from Apache, ensuring that the access is restricted to only those users
that have a valid username and password.<br>













<br>













<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">













  <tbody>













    <tr>













      <td>[bash]# <span style="font-weight: bold;">vi
/etc/httpd/conf.d/phpLDAPadmin.conf</span><br>













      </td>













    </tr>













    <tr>













      <td>Alias /ldap
"/var/www/phpldapadmin-?.?.?"<br>













      <br>













&lt;Location "/ldap"&gt;<br>













&nbsp;&nbsp;&nbsp; AuthType Basic<br>













&nbsp;&nbsp;&nbsp; AuthName "Private Area - LDAP
Administrator"<br>













&nbsp;&nbsp;&nbsp; AuthUserFile /etc/httpd/conf/authusers<br>













&nbsp;&nbsp;&nbsp; AuthGroupFile /etc/httpd/conf/authgroups<br>













&nbsp;&nbsp;&nbsp; Require group ldapusers<br>













&nbsp;&nbsp;&nbsp; Require valid-user<br>













      &lt;/Location&gt;<br>













      </td>













    </tr>













  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>













<br>













If SSL certificates where created for the Apache web server, then it
should be configured to force the phpLDAPadmin application into SSL
mode to keep it
secure. This configuration uses the rewrite module configuration we
created in <a href="13-Apache_Web_Server.html#sslcerts">Chapter
13</a>.<br>













<br>













<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">













  <tbody>













    <tr>













      <td>[bash]# <span style="font-weight: bold;">vi
/etc/httpd/conf.d/mod-rewrite.conf</span></td>













    </tr>













    <tr>













      <td>RewriteRule ^/ldap/(.*)
https://%{SERVER_NAME}/ldap/$1
[R,L] </td>













    </tr>













  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>













<br>













The Apache web server needs to be restarted before the settings will be
implemented.<br>













<br>













<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">













  <tbody>













    <tr>













      <td>[bash]# <span style="font-weight: bold;">/etc/init.d/httpd
restart</span><br>













      </td>













    </tr>













  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>













<br>













If everything has gone well you should now be able to access the
phpLDAPadmin application on the local server at: <a href="https://localhost/ldap">https://localhost/ldap</a>.<br>













<br>













<h2><a name="clients"></a><a href="#top">Email
Client Settings</a></h2>













The last steps in setting up the shared address book is to configure
the users email clients to access the LDAP server.<br>













<br>













The following table contains some of the information needed to
configure the client applications. Note the username will need to be
written as the complete "distinguished name" value so the server knows
which object to authenticate.<br>













<br>













Remember, not all clients can write to the address book, so use the
phpLDAPadmin application to add and manage the entries as needed.<br>













<br>













<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left;" border="1" cellpadding="5" cellspacing="2">













  <tbody>













    <tr>













      <td style="font-family: monospace;"><span style="font-weight: bold;">LDAP
Server:</span><br>













      </td>













      <td style="font-family: monospace;">galaxy.example.com:389<br>













      </td>













    </tr>













    <tr>













      <td style="font-weight: bold; width: 140px; font-family: monospace;">Search Base:<br>













      </td>













      <td style="width: 756px; font-family: monospace;">ou=addressbook,dc=example,dc=com</td>













    </tr>













    <tr>













      <td style="font-weight: bold; width: 140px; font-family: monospace;">Login
Method:<br>













      </td>













      <td style="width: 756px; font-family: monospace;">use
distinguished name (if listed)<br>













      </td>













    </tr>













    <tr>













      <td style="font-weight: bold; width: 140px; font-family: monospace;">Username:<br>













      </td>













      <td style="width: 756px; font-family: monospace;">uid=alice,ou=users,dc=example,dc=com </td>













    </tr>













    <tr>













      <td style="font-family: monospace;"><span style="font-weight: bold;">Password:</span><br>













      </td>













      <td style="font-family: monospace;">As entered in
useraccount.ldif file (plain text version)<br>













      </td>













    </tr>













    <tr>













      <td style="font-family: monospace;"><span style="font-weight: bold;">Secure
Connection:</span><br>













      </td>













      <td style="font-family: monospace;">Never (unless encryption has been configured)<br>













      </td>













    </tr>













  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>













<br>













If you&nbsp;configured SquirrelMail on your server during Chapter 13,
you will be pleased to hear that SquirrelMail is able to be configured
to use an LDAP address book.<br>
<br>
You can use the following commands to configure&nbsp;SquirrelMail to use your new LDAP address book.<br>










<br>






















<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">






















  <tbody>






















    <tr>






















      <td><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span>










      <span style="font-weight: bold;"></span><span style="font-weight: bold;"></span>[bash]# <span style="font-weight: bold;">cd /usr/share/squirrelmail/config<br>










      </span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span>[bash]# <span style="font-weight: bold;">./conf.pl</span></td>






















    </tr>






















  
  
  
  
  
  
  
  
  
  
  
    
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>





















<br>
<span style="font-weight: bold;"></span>The following list of client
configurations should be used as a guide only, they may differ between
versions and operating systems.<br>













<br>













<div style="text-align: center;"><span style="color: rgb(255, 0, 0); font-weight: bold;">If you are aware of
extra client settings that are not listed below, please send me the
connection details to have them added.</span><br>













</div>













<br>













<h3>Linux Clients</h3>













<span style="font-weight: bold;">- Evolution (Ver 2.0):<br>













</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (can read and write)<span style="font-weight: bold;"><br>













</span>1.&nbsp;&nbsp; Press "CTRL+SHIFT+B", this opens "Add Address
Book"<br>













2.&nbsp;&nbsp; Select "Type: On LDAP Servers"<br>













3.&nbsp;&nbsp; Enter configuration details then save and close<br>













<br>
<span style="font-weight: bold;">- Thunderbird (Ver 1.5x):<br>













</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (read only)<span style="font-weight: bold;"><br>













</span>1.&nbsp;&nbsp; Press "CTRL+2", this opens "Add Address
Book"<br>













2.&nbsp;&nbsp; Select "Edit" --&gt; "Preferences" --&gt; "Composition" --&gt; "Addressing"<br>













3.&nbsp;&nbsp; Select "Directory Server" check box, then click "Edit Directories"<br>













4.&nbsp;&nbsp; Enter configuration details then save and close<br>













<br>













<h3>Microsoft Clients</h3>













<span style="font-weight: bold;">- Microsoft Outlook 2003:<br>













</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (read only)<span style="font-weight: bold;"><br>













</span>1.&nbsp;&nbsp; Select "Tools" --&gt; "E-mail Accounts" --&gt;
"Add a
new directory or address book" --&gt; "Internet Directory Service
(LDAP)"<br>













2.&nbsp;&nbsp; Enter configuration details then select "More Settings.."<br>













3.&nbsp;&nbsp; Enter the search base then save and close<br>













<br>













<span style="font-weight: bold;">- Microsoft Outlook Express (Version
6.0):<br>













</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (read only)<span style="font-weight: bold;"><br>













</span>1.&nbsp;&nbsp; Select "Tools" --&gt; "Accounts" --&gt; "Add"
--&gt;
"Directory Service"<br>













2.&nbsp;&nbsp; Enter simple configuration details from wizard<br>













3.&nbsp;&nbsp; Highlight the new address book, select "Properties"<br>













4.&nbsp;&nbsp; Enter login and search base details, save and close<br>













<br>













<span style="font-weight: bold;">&nbsp;-
Mozilla Thunderbird (Ver 1.0):<br>













</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (read only)<span style="font-weight: bold;"><br>













</span>1.&nbsp;&nbsp;&nbsp; Select "Tools" --&gt; "Options"
--&gt; "Composition"<br>













2.&nbsp;&nbsp; Under "Address Autocompletion", tick "Directory
Server", then select "Edit Directories"<br>













3.&nbsp;&nbsp; Select "Add", enter configuration details then save and
close<br>













<br>













<h3>Other Clients</h3>













??? Anyone ?<br>













<br>
<br>













<hr>
<table style="width: 100%;" border="0" cellpadding="2" cellspacing="2">













  <tbody>













    <tr>













      <td style="width: 30%; text-align: left;"><a href="19-Network_File_System.html">Previous</a><br>













      </td>













      <td style="width: 40%; text-align: center;"><a href="index.html">Home</a>
      </td>













      <td style="width: 30%; text-align: right;"><a href="21-Virtual_Private_Networking.html">Next</a><br>













      </td>













    </tr>













  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>













</body>
</html>
