<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>



















  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <meta content="text/html; charset=ISO-8859-1" http-equiv="content-type">



















  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <title>Linux Home Server HOWTO - Apache Web Server</title>
  <meta content="Miles Brennan" name="author">
</head>


<body>



















<div style="text-align: center;"><span style="font-weight: bold;"><a name="top"></a>Linux
Home Server HOWTO</span><br>



















</div>



















<table style="width: 100%;" border="0" cellpadding="2" cellspacing="2">



















  <tbody>



















    <tr>



















      <td style="width: 30%; text-align: left;"><a href="12-Sendmail_Server.html">Previous</a><br>



















      </td>



















      <td style="width: 40%; text-align: center;"><a href="index.html">Home</a>
      </td>



















      <td style="width: 30%; text-align: right;"><a href="14-FTP_Server.html">Next</a><br>



















      </td>



















    </tr>



















  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>



















<hr>
<h1>Chapter 13 - Apache Web Server</h1>










<table style="text-align: left; width: 100%;" border="0" cellpadding="1" cellspacing="1">


















  <tbody>


















    <tr>


















      <td style="width: 140px;"><span style="font-weight: bold;">Version:</span></td>


















      <td>- httpd 2.2.0</td>


















    </tr>


















  
  
  <tr>















      <td style="width: 140px;"></td>















      <td>- squirrelmail 1.4.6</td>















    </tr>















  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>


















<span style="font-weight: bold;"></span><br>



















<a href="#config">Basic
Configuration</a><br>



















<a href="#starting">Starting
the Server</a><br>



<a href="#favicon">Creating a Favicon</a><br>



















<a href="#users">User
Directories</a><br>



















<a href="#cgi">Enabling
CGI Scripts</a><br>



















<a href="#authentication">Authenticating
Users</a><br>



















<a href="#vhosts">Virtual
Hosts</a><br>



















<a href="#sslcerts"><span style="text-decoration: underline;"></span>Using
SSL Certificates</a><br>



















<a href="#webmail">Webmail
Configuration</a><br>



















<br>



















The Apache web server is a highly scalable product capable of running
on many platforms and serving thousands of pages a minute. It provides
a stable and secure environment for the host server, and is the
industry leader in the web server market. The server package comes
bundled
with most Linux distributions and only requires little configuration
changes (if any) to be up and serving pages immediately. If you're
serious about your web development and its a fully dynamic hosting
environment you need, then Apache, <a href="http://www.php.net">PHP</a>
and <a href="http://www.mysql.com">MySQL</a>
are perfectly suited
together, and are also provided with most distributions.<br>



















<br>



















The Apache server configuration can be a little scary because its a
large file containing three main sections (Global Environment, Main
Server Configuration and Virtual Hosts). In fact, the configuration has
been broken even further so that any additional modules have their own
configuration files, which are located in a different directory.
Confused? Don't be, its relatively easy to understand once you start
playing with it.<br>



















<br>



















<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">



















  <tbody>



















    <tr>



















      <td style="width: 175px; font-family: monospace;">Configuration
File Dir:<br>



















      </td>



















      <td style="width: 721px; font-family: monospace;">/etc/httpd/conf</td>



















    </tr>



















    <tr>



















      <td style="width: 175px; font-family: monospace;">Extra
Module Files Dir:<br>



















      </td>



















      <td style="width: 721px; font-family: monospace;">/etc/httpd/conf.d</td>



















    </tr>



















  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>



















<br>



















This chapter will cover some of the more common configuration details
so you can get the Apache server running and also provide you with some
more advanced steps to enable user directories, authentication, and SSL
so you can tailor the server to your needs. The Apache web server comes
complete with its own user manual detailing many configuration
scenarios, FAQs and even HOWTOs. To access the manuals (once your
server
is running) goto <a href="http://localhost/manual">http://localhost/manual</a>.<br>



















<br>



















<h2><a name="config"></a><a href="#top">Basic
Configuration</a><br>



















</h2>



















The initial configuration file for Apache already provides enough
details to get the server running straight away and if you only want
the basics in hosting, it will probably be all you need. But like most
individuals, we want to tailor it to suit our needs. Before we start,
lets backup the original configuration so we have a good file to
restore from if everything turns bad. If you are not one hundred
percent sure what a particular configuration directive does, then its
advised not to change it.<br>



















<br>



















<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">



















  <tbody>



















    <tr>



















      <td>[bash]# <span style="font-weight: bold;">cp
/etc/httpd/conf/httpd.conf
/etc/httpd/conf/httpd.conf.original</span><br>



















[bash]# <span style="font-weight: bold;">vi /etc/httpd/conf/httpd.conf</span><span style="font-weight: bold;"></span><br>



















      </td>



















    </tr>



















  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>



















<br>



















The <span style="font-family: monospace; font-weight: bold;">ServerRoot</span>
directive
is where the configuration files, error logs, and access files are
stored (normally the log and error directories are symbolic links to
another
location), you probably don't want to change this setting.<br>



















<br>



















<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">



















  <tbody>



















    <tr>



















      <td>ServerRoot "/etc/httpd"<br>



















      </td>



















    </tr>



















  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>



















<br>



















<table style="width: 100%; text-align: left;" border="1" cellpadding="2" cellspacing="2">



















  <tbody>



















    <tr>



















      <td style="vertical-align: middle; text-align: center; width: 52px;"><img style="width: 24px; height: 24px;" alt="Warning !!" src="images/warning.gif"></td>



















      <td><span style="font-weight: bold;">DO
NOT</span> add a trailing
slash "/" to the directory names when making changes. If they are
already there (like cgi-bin), then leave them.<br>



















      </td>



















    </tr>



















  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>



















<br>



















The <span style="font-family: monospace; font-weight: bold;">Listen</span>
directive
specifies the port number and IP address (optional) that the server
should bind and listen to.<br>



















<br>



















<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">



















  <tbody>



















    <tr>



















      <td style="width: 200px;">Listen
80</td>



















      <td style="width: 696px;">All
clients can connect (preferred)<br>



















      </td>



















    </tr>



















    <tr>



















      <td style="width: 200px;">Listen
192.168.1.1:80<br>



















      </td>



















      <td style="width: 696px;">Only
clients on the internal network
can connect<br>



















      </td>



















    </tr>



















  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>



















<br>



















The Apache server has many modules that have been written to support
certain events, like allowing users to have their own websites running
from the main server. These modules must be declared and loaded inside
the configuration file before the functions required from the module
can be used.<br>



















<br>



















Not having a particular module loaded when you need it can be quite
frustrating when you are debugging your server, always have a quick
look at the Module Index in the manual for further details and
assistance (<a href="http://localhost/manual/mod">http://localhost/manual/mod</a>).<br>



















<br>



















<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">



















  <tbody>



















    <tr>



















      <td>LoadModule
userdir_module modules/mod_userdir.so<br>



















LoadModule cgi_module modules/mod_cgi.so<br>



















LoadModule rewrite_module modules/mod_rewrite.so<br>



















      </td>



















    </tr>



















  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>



















<span style="font-family: monospace;">These
are examples, of LoadModule
- do not adjust unless needed.</span><br>



















<br>



















This <span style="font-family: monospace; font-weight: bold;">Include</span>&nbsp;statement
allows any separate configuration files in the <span style="font-family: monospace; font-weight: bold;">"/etc/httpd/conf.d"</span>
directory, to
be loaded with the main configuration during start/reload time. The
separate configuration files must end in the <span style="font-family: monospace;">.conf</span>
file extension.<br>



















<br>



















<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">



















  <tbody>



















    <tr>



















      <td>Include conf.d/*.conf<br>



















      </td>



















    </tr>



















  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>



















<br>



















The server provides some basic real-time status information while its
operating, some further details can be provided by setting the <span style="font-family: monospace; font-weight: bold;">ExtendedStatus</span>
to <span style="font-weight: bold; font-family: monospace;">"on"</span>.<br>



















<br>



















<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">



















  <tbody>



















    <tr>



















      <td>ExtendedStatus On<br>



















      </td>



















    </tr>



















  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>



















<br>



















The <span style="font-family: monospace;">User</span>
and <span style="font-family: monospace;">Group</span>
values specify the local
user and group accounts that Apache should run as.<br>



















<br>



















<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">



















  <tbody>



















    <tr>



















      <td>User apache<br>



















Group apache<br>



















      </td>



















    </tr>



















  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>



















<br>



















This directive provides a contact email address for any error messages
that a user might receive from the server.<br>



















<br>



















<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">



















  <tbody>



















    <tr>



















      <td>ServerAdmin
sysadmin@example.com<br>



















      </td>



















    </tr>



















  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>



















<br>



















Remember that our real server's hostname is <span style="font-family: monospace;">galaxy.example.com</span>,
but people
out on the Internet are accessing our server with the URL of <span style="font-family: monospace;">www.example.com</span>
because we have
set up an alias (CNAME) in the DNS. Setting the <span style="font-family: monospace;">ServerName</span>
directive allows the
server to handle redirections easier. The <span style="font-family: monospace;">ServerName</span>
is also displayed in
any error messages that a user might receive from the server.<br>



















<br>



















If you set the <span style="font-family: monospace;">ServerName</span>
directive, you should also set the <span style="font-family: monospace;">UseCanonicalName</span>
directive to "<span style="font-family: monospace;">On</span>"
(recommended for both).<br>



















<br>



















<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">



















  <tbody>



















    <tr>



















      <td>ServerName
www.example.com:80</td>



















    </tr>



















    <tr>



















      <td>UseCanonicalName On<br>



















      </td>



















    </tr>



















  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>



















<br>



















<table style="width: 100%; text-align: left;" border="1" cellpadding="2" cellspacing="2">



















  <tbody>



















    <tr>



















      <td style="vertical-align: middle; text-align: center; width: 52px;"><img style="width: 24px; height: 24px;" alt="Note !!" src="images/note.gif"></td>



















      <td>For DNS, the servers
real name is <span style="font-family: monospace;">galaxy</span>,
the <span style="font-family: monospace;">www</span>
name is an alias (CNAME)
which points to the real <span style="font-family: monospace;">galaxy</span>
hostname.<br>



















      </td>



















    </tr>



















  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>



















<br>



















The <span style="font-family: monospace;">DocumentRoot</span>
is where
all of your new web pages need to be placed so Apache can serve them to
connecting users.<br>



















<br>



















<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">



















  <tbody>



















    <tr>



















      <td>DocumentRoot
"/var/www/html"</td>



















    </tr>



















  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>



















<br>



















The <span style="font-family: monospace;">DirectoryIndex</span>
details the name of the default page which is displayed when someone
connects to the server. The default page is checked in sequential order
as they are listed, so <span style="font-family: monospace;">index.html</span>
would be served before <span style="font-family: monospace;">index.html.var</span>
if they both existed in the same directory.<br>



















<br>



















If you have extra modules loaded like PHP, they may have their own <span style="font-family: monospace;">DirectoryIndex</span>
directives
within their own configuration files (in <span style="font-family: monospace;">conf.d</span>
directory). Always check
the other
configurations before adding your own, you may find its unnecessary.<br>



















<br>



















<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">



















  <tbody>



















    <tr>



















      <td>DirectoryIndex
index.html index.html.var<br>



















      </td>



















    </tr>



















  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>



















<br>



















The <span style="font-family: monospace;">AccessFileName</span>
specifies the <span style="font-weight: bold;">first</span>
file read
each time a user enters a directory. The filename (normally <span style="font-family: monospace;">.htaccess</span>)
can contain extra
configuration settings that are applied to the directory where it
resides. The <span style="font-family: monospace;">.htaccess</span>
file is commonly used to specify any access restrictions or user
authentication details for the directory (see Authenticating Users).<br>



















<br>



















<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">



















  <tbody>



















    <tr>



















      <td>AccessFileName .htaccess</td>



















    </tr>



















  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>



















<br>



















<table style="width: 100%; text-align: left;" border="1" cellpadding="2" cellspacing="2">



















  <tbody>



















    <tr>



















      <td style="vertical-align: middle; text-align: center; width: 52px;"><img style="width: 24px; height: 24px;" alt="Caution !!" src="images/caution.gif"></td>



















      <td>It is widely known that
Apache uses the filename "<span style="font-family: monospace;">.htaccess</span>"
as the
default file for basic authentication. It is recommended
that you change the name of the file as any serious attacker will
definitely target that filename. The file should be safe, but the extra
precaution won't hurt. Keep with ".ht" for start of filename.<br>



















      </td>



















    </tr>



















  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>



















<br>



















Setting <span style="font-family: monospace;">HostnameLookups</span>
tells the server to do a reverse DNS lookup for
every IP address that connects to it, then the resulting hostname is
logged in the access log. Unless you are doing detailed log file
analysis, you shouldn't need this feature.<br>



















<br>



















<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">



















  <tbody>



















    <tr>



















      <td>HostnameLookups Off<br>



















      </td>



















    </tr>



















  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>



















<br>



















Any error messages generated by the server can have an additional
footer added with contains information about the server. The "<span style="font-family: monospace;">Email</span>"
value configures the
footer informatiion to contain the "<span style="font-family: monospace;">ServerAdmin</span>"
email address.<br>



















<br>



















<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">



















  <tbody>



















    <tr>



















      <td>ServerSignature Email<br>



















      </td>



















    </tr>



















  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>



















<br>



















This setting tells Apache which character set should be used as the
default for any content that is defined in the HTTP headers.<br>



















<br>



















<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">



















  <tbody>



















    <tr>



















      <td>AddDefaultCharset UTF-8<br>



















      </td>



















    </tr>



















  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>



















<br>



















The <span style="font-family: monospace;">server-status</span>
provides real-time status information about the
active Apache server. Access restrictions can be applied similar to
the example. This is accessible by typing <a href="http://localhost/server-status">http://localhost/server-status</a>.<br>



















<br>



















<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">



















  <tbody>



















    <tr>



















      <td>&lt;Location
/server-status&gt;<br>



















&nbsp;&nbsp;&nbsp; SetHandler server-status<br>



















&nbsp;&nbsp;&nbsp; Order deny,allow<br>



















&nbsp;&nbsp;&nbsp; Deny from all<br>



















&nbsp;&nbsp;&nbsp; Allow from .example.com<br>















&nbsp;&nbsp;&nbsp; Allow from 127.0.0.1 192.168.1.0/24<br>



















&lt;/Location&gt;<br>



















      </td>



















    </tr>



















  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>



















<br>



















The <span style="font-family: monospace;">server-info</span>
provides
real-time configuration information about the
active Apache server. Access restrictions can be applied similar to
the example. This is accessible by typing <a href="http://localhost/server-info">http://localhost/server-info</a>.<br>



















<br>



















<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">



















  <tbody>



















    <tr>



















      <td>&lt;Location
/server-info&gt;<br>



















&nbsp;&nbsp;&nbsp; SetHandler server-info<br>



















&nbsp;&nbsp;&nbsp; Order deny,allow<br>



















&nbsp;&nbsp;&nbsp; Deny from all<br>



















&nbsp;&nbsp;&nbsp; Allow from .example.com<br>



















&nbsp;&nbsp;&nbsp; Allow from 127.0.0.1 192.168.1.0/24<br>



















&lt;/Location&gt;<br>



















      </td>



















    </tr>



















  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>



















<br>



















We have only covered some of the more common settings here. Remember
the
provided manual is the best source of information to assist with
further configuration and detailed assistance, assuming you get your
server running.<br>



















<h2><a name="starting"></a><a href="#top">Starting
the Server</a><br>



















</h2>



















The Apache server runs under the "httpd" service name, so lets set the
appropriate runlevels and then confirm they are correct.<br>



















<br>



















<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">



















  <tbody>



















    <tr>



















      <td>[bash]# <span style="font-weight: bold;">chkconfig
--level 345 httpd on</span><br>



















[bash]# <span style="font-weight: bold;">chkconfig
--list httpd</span><br>



















      </td>



















    </tr>



















  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>



















<br>



















The server can now be started and the system log should be checked for
any
initialisation or runtime errors.<br>



















<br>



















<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">



















  <tbody>



















    <tr>



















      <td>[bash]# <span style="font-weight: bold;">/etc/init.d/httpd
restart</span><br>



















[bash]# <span style="font-weight: bold;">grep httpd /var/log/messages</span><br>



















[bash]# <span style="font-weight: bold;">tail /var/log/httpd/error_log</span><br>



















      </td>



















    </tr>



















  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>



















<br>




<h2><a name="favicon"></a><a href="#top">Creating a Favicon</a></h2>



















Most of the latest web browsers now support the use of favicons, which
are a small image (icon) file located in your <span style="font-family: monospace;">DocumentRoot</span>
directory. When a
clients browser requests a web page, it also requests the favicon and
if its available, displays the favicon in the address field next to the
web sites URL. The favicon is able to store a few different sizes in
the one image, this allows it to display the appropriate size image
when your web site is bookmarked or saved as a desktop shortcut. There
are a
few sites on the Internet that have free favicons available for
download, or you can generate your own to provide a more personal feel
for your site.<br>





<br>



Creating your own favicon can be a bit fiddly, so we'll automate the
process with&nbsp;a small propose written script. Firstly we need to
install the netpbm image manipulation applications using the following
command.<br>





<br>



















<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">



















  <tbody>



















    <tr>



















      <td>[bash]# <span style="font-family: mon;"><span style="font-weight: bold;">yum install netpbm-progs</span></span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span><br>



















      </td>



















    </tr>



















  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>


















<br>



Now we can create our <span style="font-weight: bold; font-family: monospace;">"makefavicon"</span>
shell script. This script will convert any size image file into the
three standard 16x16, 32x32 and 48x48 files required to create a
standard favicon file. The default image files that will be excepted by
the script are PAM, PNM, PPM, PGM and PBM; other images files can be
easily converted to the required image format by using one of the many
image tools available in the netpbm-progs suite of applications (there
are approx 200 apps, mostly image conversion). Type <span style="font-weight: bold; font-family: monospace;">"man netpbm"</span> at the command prompt for more info on the other applications available in netpbm.<br>





<br>



















<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">



















  <tbody>



















    <tr>



















      <td>[bash]# <span style="font-weight: bold;">vi /bin/makefavicon</span><br>





      <span style="font-weight: bold;"></span>













      </td>



















    </tr>



















  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <tr>




      <td>#!/bin/sh<br>




      <br>




if [ -z $1 ] ; then<br>




&nbsp;&nbsp;&nbsp; echo -e "\\nUsage: \"makefavicon &lt;image_filename.png&gt;\"\\n"<br>




&nbsp;&nbsp;&nbsp; echo -e "Suitable file types are: PAM, PNM, PPM, PGM, or PBM.\\n"<br>




&nbsp;&nbsp;&nbsp; exit<br>




fi<br>




      <br>




rm -f favicon.ico<br>




      <br>




pamscale -linear -xsize=48 -ysize=48 $1 &gt; tmp_logo48.ppm<br>




pamscale -linear -xsize=32 -ysize=32 $1 &gt; tmp_logo32.ppm<br>




pamscale -linear -xsize=16 -ysize=16 $1 &gt; tmp_logo16.ppm<br>




      <br>




pnmquant 256 tmp_logo48.ppm &gt; tmp_logo48x48.ppm<br>




pnmquant 256 tmp_logo32.ppm &gt; tmp_logo32x32.ppm<br>




pnmquant 256 tmp_logo16.ppm &gt; tmp_logo16x16.ppm<br>




      <br>




ppmtowinicon tmp_logo16x16.ppm tmp_logo32x32.ppm tmp_logo48x48.ppm -output favicon.ico<br>




      <br>




rm -f tmp_logo*.ppm</td>




    </tr>




  
  
  
  
  </tbody>
</table>


















<br>





Once we have created our script, we need to grant execution permissions on the file.<br>





<br>



















<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">



















  <tbody>



















    <tr>



















      <td><span style="font-family: mon;"><span style="font-weight: bold;"><span style="font-family: monospace;"></span></span></span><span style="font-weight: bold;"></span>[bash]# <span style="font-family: mon;"><span style="font-weight: bold;"><span style="font-family: monospace;">chmod +x /bin/makefavicon</span></span></span><span style="font-family: mon;"><span style="font-weight: bold;"><span style="font-family: monospace;"></span></span></span><br>




      </td>



















    </tr>



















  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>


















<br>



The script is executed at the command prompt with the image to be converted to a favicon listed as an argument to the script.<br>



<br>



















<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">



















  <tbody>



















    <tr>



















      <td><span style="font-family: mon;"><span style="font-weight: bold;"><span style="font-family: monospace;"></span></span></span>[bash]#&nbsp;<span style="font-family: mon;"><span style="font-weight: bold;"><span style="font-family: monospace;">makefavicon image_file.ppm</span></span></span><br>




      </td>



















    </tr>



















  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>

















<br>



To convert a PNG file to a favicon, execute the following command which
firstly converts the file to PNM format, then it can be converted with
the script.<br>




<br>



















<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">



















  <tbody>



















    <tr>



















      <td><span style="font-family: mon;"><span style="font-weight: bold;"><span style="font-family: monospace;"></span></span></span><span style="font-weight: bold;"></span>[bash]# <span style="font-weight: bold;">pngtopnm -mix pic_file.png &gt; file_to_convert.pnm</span><span style="font-family: mon;"><span style="font-weight: bold;"><span style="font-family: monospace;"><br>




      </span></span></span>[bash]#&nbsp;<span style="font-family: mon;"><span style="font-weight: bold;"><span style="font-family: monospace;">makefavicon file_to_convert.pnm</span></span></span><br>




      </td>



















    </tr>



















  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>

















<br>




The icon file now needs to be placed inside the Apache server's document root directory.<br>




<br>



















<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">



















  <tbody>



















    <tr>



















      <td><span style="font-family: mon;"><span style="font-weight: bold;"><span style="font-family: monospace;"></span></span></span><span style="font-weight: bold;"></span>[bash]# <span style="font-weight: bold;"><span style="font-family: monospace;">cp favicon.ico /var/www/html/</span></span><span style="font-family: mon;"><span style="font-weight: bold;"><span style="font-family: monospace;"></span></span></span><br>




      </td>



















    </tr>



















  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>

















<br>




The favicon.ico file will be automatically passed to remote web
browsers as they connect to your server (no need to edit html pages),
however you are able to manually place inline references to the favicon
if required; this would mainly be done if you wish your pages to use
different favicon sets.<br>



<br>



















<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">



















  <tbody>



















    <tr>



















      <td><span style="font-family: mon;"><span style="font-weight: bold;"><span style="font-family: monospace;"></span></span></span><span style="font-weight: bold;"></span>[bash]# <span style="font-family: monospace; font-weight: bold;">vi /var/www/html</span><span style="font-weight: bold;">/index.html</span><span style="font-family: mon;"><span style="font-weight: bold;"><span style="font-family: monospace;"></span></span></span><br>




      </td>



















    </tr>



















  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <tr>



      <td><kbd>&lt;link rel="icon" href="favicon.ico" type="image/x-icon"&gt;</kbd><br>




      <kbd>&lt;link rel="shortcut icon" href="favicon.ico" type="image/x-icon"&gt;</kbd></td>



    </tr>



  
  
  
  </tbody>
</table>

















<br>



















<h2><a name="users"></a><a href="#top">User
Directories</a><br>



















</h2>



















The Apache server is capable of serving web pages straight from the
directories of your system user accounts. This allows all the system
users the ability to run their own web sites which are hosted off the
main server. This is exactly the same way that many ISPs provide
websites for their customers and its relatively easy to enable.<br>



















<br>



















The important thing to be aware of firstly, is that a site hosted from
a users home directory needs to have a tilde "~" placed in front of the
users name like in the following two examples.<br>



















<br>



















<table style="background-color: rgb(220, 220, 220); width: 100%; text-align: left;" border="1" cellpadding="2" cellspacing="2">



















  <tbody>



















    <tr>



















      <td style="width: 120px; background-color: rgb(255, 255, 255); font-weight: bold; font-family: monospace;">Username<br>



















      </td>



















      <td style="width: 195px; background-color: rgb(255, 255, 255); font-weight: bold; font-family: monospace;">Home
Directory<br>



















      </td>



















      <td style="width: 585px; background-color: rgb(255, 255, 255); font-weight: bold; font-family: monospace;">Users
URL<br>



















      </td>



















    </tr>



















    <tr>



















      <td style="font-family: monospace; width: 120px;">alice<br>



















      </td>



















      <td style="font-family: monospace; width: 195px;">/home/alice/public_html</td>



















      <td style="font-family: monospace; width: 585px;">http://www.example.com/~alice</td>



















    </tr>



















    <tr>



















      <td style="font-family: monospace; width: 120px;">bob<br>



















      </td>



















      <td style="font-family: monospace; width: 195px;">/home/bob/public_html</td>



















      <td style="font-family: monospace; width: 585px;">http://www.example.com/~bob</td>



















    </tr>



















  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>



















<br>



















To enable the public folders for the users, locate the following
section in the configuration file and make the adjustments required
similar to the example. The "<span style="font-family: monospace;">public_html</span>"
value identifies the directory name inside the users home directory
where the files will be served from. This value can be changed if you
feel its easier for your users to understand and if you do change it,
make the change early in the servers configuration and not after all
your users have already established their web sites. This may save some
later
problems.<br>



















<br>



















<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">



















  <tbody>



















    <tr>















      <td>



[bash]# <span style="font-weight: bold;">vi /etc/httpd/conf/httpd.conf</span></td>















    </tr>















    <tr>



















      <td>&lt;IfModule
mod_userdir.c&gt;<br>



















# &nbsp;&nbsp; UserDir disable<br>



















&nbsp;&nbsp;&nbsp;&nbsp; UserDir public_html<br>



















&lt;/IfModule&gt;<br>



















      </td>



















    </tr>















    <tr>















      <td>&lt;Directory
/home/*/public_html&gt;<br>



















&nbsp;&nbsp;&nbsp; AllowOverride FileInfo AuthConfig Limit<br>



















&nbsp;&nbsp;&nbsp; Options MultiViews Indexes
SymLinksIfOwnerMatch
IncludesNoExec<br>



















&nbsp;&nbsp;&nbsp; &lt;Limit GET POST OPTIONS&gt;<br>



















&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
Order allow,deny<br>



















&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
Allow from all<br>



















&nbsp;&nbsp;&nbsp; &lt;/Limit&gt;<br>



















&nbsp;&nbsp;&nbsp; &lt;LimitExcept GET POST
OPTIONS&gt;<br>



















&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
Order deny,allow<br>



















&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
Deny from all<br>



















&nbsp;&nbsp;&nbsp; &lt;/LimitExcept&gt;<br>



















&lt;/Directory&gt;</td>















    </tr>



















  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>



















<br>



















<h3>File Permissions</h3>



















One of the biggest problems that most people face when setting up
public html folders, is the permissions required for the server to
access and serve the pages. The server does not have access to the
users home directories by default, so the following changes need to be
made by the user (or root) to allow access.<br>



















<br>



















The best way for users to upload their webpages to the server is by
using the FTP service on the localhost. If FTP is going to be made
available for public access, ensure that users are chroot jailed inside
their own home directories, this prevents unwanted users wondering
around the filesystem (See chap 14 for FTP details).<br>



















<br>



















<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">



















  <tbody>



















    <tr>



















      <td style="background-color: rgb(255, 255, 255); font-weight: bold;">Permissions<br>



















      </td>



















      <td style="background-color: rgb(255, 255, 255); font-weight: bold;">Resource<br>



















      </td>



















    </tr>



















    <tr>



















      <td style="width: 100px;">chmod
701<br>



















      </td>



















      <td style="width: 796px;">/home/*<br>



















      </td>



















    </tr>



















    <tr>



















      <td style="width: 100px;">chmod
705</td>



















      <td style="width: 796px;">/home/*/public_html</td>



















    </tr>



















    <tr>



















      <td style="width: 100px;">chmod
604</td>



















      <td style="width: 796px;">/home/*/public_html/*.html</td>



















    </tr>



















    <tr>



















      <td style="width: 100px;">chmod
705</td>



















      <td style="width: 796px;">/home/*/public_html/cgi-bin</td>



















    </tr>



















    <tr>



















      <td style="width: 100px;">chmod
705</td>



















      <td style="width: 796px;">/home/*/public_html/cgi-bin/*.cgi&nbsp;
&nbsp; &nbsp; &nbsp; (or *.pl)<br>



















      </td>



















    </tr>



















  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>



















<br>



















It can be time consuming for the local administrator to create all the
public html folders and set the required permissions, or the user may
not know how or set them correctly. This configuration process can be
automated by making adjustments to the local skeleton profile, then
when any new user accounts are created all of the directories and
permissions are already set and ready for use.<br>



















<br>



















<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">



















  <tbody>



















    <tr>



















      <td>[bash]# <span style="font-weight: bold;">mkdir
/etc/skel/public_html</span><br>



















[bash]# <span style="font-weight: bold;">mkdir /etc/skel/public_html/cgi-bin</span><br>



















[bash]# <span style="font-weight: bold;">chmod 705 /etc/skel/public_html</span><br>



















[bash]# <span style="font-weight: bold;">chmod 705 /etc/skel/public_html/cgi-bin/</span><br>



















      </td>



















    </tr>



















  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>



















<br>



















<table style="width: 100%; text-align: left;" border="1" cellpadding="2" cellspacing="2">



















  <tbody>



















    <tr>



















      <td style="vertical-align: middle; text-align: center; width: 52px;"><img style="width: 24px; height: 24px;" alt="Caution !!" src="images/caution.gif"></td>



















      <td>Not all Linux
distributions have the skeleton profile located
in the same area.<br>



















      </td>



















    </tr>



















  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>



















<br>



















A very basic HTML page can also be added to the skeleton profile which
will
be available to the Apache server as soon as a new account is created.
This is not necessarily needed, but can assist new users by showing
them the location of the relevant file.<br>



















<br>



















<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">



















  <tbody>



















    <tr>



















      <td>[bash]# <span style="font-weight: bold;">echo 'Test User
Page !' &gt;
/etc/skel/public_html/index.html</span><br>



















[bash]# <span style="font-weight: bold;">chmod 604 /etc/skel/public_html/index.html</span><br>



















      </td>



















    </tr>



















  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>



















<br>



















Some users like to run their own CGI scripts which allows them to
interact with the localhost to some degree. As with the above example,
a basic CGI script can be created for the skeleton profile to assist
new users. It also provides the user with a basic working script for
testing purposes.<br>



















<br>



















<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">



















  <tbody>



















    <tr>



















      <td>[bash]# <span style="font-weight: bold;">vi
/etc/skel/public_html/cgi-bin/test.cgi</span><br>



















      </td>



















    </tr>



















    <tr>



















      <td><code>#!/usr/bin/perl<br>



















print "Content-type: text/html\n\n";<br>



















print "Hello, World.";<br>



















      </code></td>



















    </tr>



















    <tr>



















      <td><code></code>[bash]#
      <span style="font-weight: bold;">chmod 705
/etc/skel/public_html/cgi-bin/test.cgi</span><br>



















      </td>



















    </tr>



















  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>



















<br>



















<table style="width: 100%; text-align: left;" border="1" cellpadding="2" cellspacing="2">



















  <tbody>



















    <tr>



















      <td style="vertical-align: middle; text-align: center; width: 52px;"><img style="width: 24px; height: 24px;" alt="Note !!" src="images/note.gif"></td>



















      <td>Setting cgi-bin
files, directories and permissions in the skeleton profile DOES NOT
enable CGI for local users, this must be configured manually in the <span style="font-family: monospace;">httpd.conf</span>
file before the
service is available.<br>



















      </td>



















    </tr>



















  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>



















<br>



















<h3>Forbidden Errors (SELinux)<br>



















</h3>



















You may experience a "forbidden error" when attempting to access a
users public web site (http://localhost/~alice), this is generally
because the permissions are either set incorrectly, or SELinux is set
to "Enforcing" mode which blocks the standard <span style="font-family: monospace;">suexec</span>
call needed by the
Apache server. <span style="font-weight: bold;">Common error is the "</span><span style="font-family: monospace; font-weight: bold;">/home/username</span><span style="font-weight: bold;">"
permissions.</span><br>



















<br>



















To temporarily disable SELinux so you can test the access permissions,
type "<span style="font-family: monospace;">setenforce
0</span>" at the
command prompt. Typing "<span style="font-family: monospace;">setenforce
1</span>" sets SELinux back to
Enforcing mode.<br>



















<br>



















Use the following commands to permanently adjust the SELinux file
security context so Apache can access user's public web sites.<br>



















<br>



















<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">



















  <tbody>



















    <tr>



















      <td>### SELinux ONLY - Enable User Website<br>



















[bash]# <span style="font-weight: bold;">setsebool -P httpd_enable_homedirs true</span><br>



















[bash]# <span style="font-weight: bold;">chcon -v -R -h -u user_u -t httpd_user_content_t
/home/*/public_html</span><br>



















      </td>



















    </tr>



















    <tr>



















      <td>### SELinux ONLY - Disable User Website<br>



















[bash]# <span style="font-weight: bold;">setsebool -P httpd_enable_homedirs false</span><br>



















[bash]# <span style="font-weight: bold;">chcon -v -R -h -u user_u -t user_home_t /home/*/public_html</span><br>



















      </td>



















    </tr>



















  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>



















<br>



















<h2><a name="cgi"></a><a href="#top">Enabling
CGI
Scripts</a><br>



















</h2>



















A CGI (Common Gateway Interface) provides a means for web content to
interact with programs or applications running on the localhost server,
like calling the current <span style="font-family: monospace;">date</span>
or <span style="font-family: monospace;">uptime</span>.
The default
configuration of Apache allows global CGI scripts for root, however it
must be manually configured for public users.<br>



















<br>



















Because CGI scripts are able to call local programs and applications on
the server, you should consider whether local public users should be
allowed to run their own applications. Many ISPs do not allow their
customers to execute CGI on their servers for fear of malicious code or
content, and for good reason. Some smaller or more trusted environments
may allow public CGI scripts, so this is how we set them up.<br>



















<br>



















<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">



















  <tbody>



















    <tr>



















      <td>[bash]# <span style="font-weight: bold;">vi
/etc/httpd/conf/httpd.conf</span> </td>



















    </tr>



















  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>



















<br>



















The <span style="font-family: monospace;">ScriptAlias</span>
directive
is similar to the standard <span style="font-family: monospace;">Alias</span>
directive, however it tells the system that the contents of the
directory should be treated as system scripts and not as standard HTML
content. The following are the global cgi-bin settings for the main
server, it is normally enabled by default because root should be
trusted, we hope.<br>



















<br>



















<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">



















  <tbody>



















    <tr>



















      <td>ScriptAlias /cgi-bin/
"/var/www/cgi-bin/"</td>



















    </tr>



















    <tr>



















      <td>&lt;Directory
"/var/www/cgi-bin"&gt;<br>



















&nbsp;&nbsp;&nbsp; AllowOverride None<br>



















&nbsp;&nbsp;&nbsp; Options None<br>



















&nbsp;&nbsp;&nbsp; Order allow,deny<br>



















&nbsp;&nbsp;&nbsp; Allow from all<br>



















&lt;/Directory&gt; </td>



















    </tr>



















  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>



















<br>



















To allow public CGI, we need to define the <span style="font-family: monospace;">"public_html/cgi-bin</span>"
directory,
remember if you changed the "public_html" directory for the users in
the earlier configuration, then ensure the following suits the
adjustments.<br>



















<br>



















The <span style="font-family: monospace;">AddHandler</span>
directive
provides the means for any cgi-scripts to be
handled that are located outside the global cgi-bin directory, which in
this case is the public users home directories.<br>



















<br>



















<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">



















  <tbody>



















    <tr>



















      <td>&lt;Directory
/home/*/public_html/cgi-bin&gt;<br>



















&nbsp;&nbsp;&nbsp; Options ExecCGI<br>



















&nbsp;&nbsp;&nbsp; SetHandler cgi-script<br>



















&lt;/Directory&gt;<br>



















      </td>



















    </tr>



















    <tr>



















      <td>AddHandler cgi-script
.cgi .pl<code></code><br>



















      </td>



















    </tr>



















  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>



















<br>



















<h2><a name="authentication"></a><a href="#top">Authenticating
Users</a><br>



















</h2>



















<h3>Main Server Authentication</h3>



















Restricting access to resources on the web server can be achieved a few
different ways. The preferred method for controlling access throughout
the main server filesystem, is to place individual directives into the <span style="font-family: monospace;">httpd.conf</span>
configuration file
for each area that needs any restrictions.<br>



















<br>



















The following example provides security to the<span style="font-family: monospace;">
/var/www/html/private</span>
directory (http://localhost/private), and will only allow valid users
from the <span style="font-family: monospace;">authusers</span>
file
if they are listed in the <span style="font-family: monospace;">private</span>
group contained in the <span style="font-family: monospace;">authgroups</span>
file.<br>



















<br>



















<table style="width: 100%; text-align: left;" border="1" cellpadding="2" cellspacing="2">



















  <tbody>



















    <tr>



















      <td style="vertical-align: middle; text-align: center; width: 52px;"><img style="width: 24px; height: 24px;" alt="Caution !!" src="images/caution.gif"></td>



















      <td>It is important to note
that the authorisation files <span style="font-weight: bold;">are
not</span> located
inside the "<span style="font-family: monospace;">DocumentRoot</span>"
structure, otherwise they could be downloaded if not properly secured. </td>



















    </tr>



















  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>



















<br>



















<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">



















  <tbody>



















    <tr>



















      <td># Provides security for
"http://www.example.com/private"<br>



















&lt;Directory "/var/www/html/private"&gt;<br>



















&nbsp;&nbsp;&nbsp; <code>
AuthType Basic<br>



















      </code>&nbsp;&nbsp;&nbsp; <code> AuthName "Private
Area -
Authorisation Required"<br>



















      </code>&nbsp;&nbsp;&nbsp; <code> AuthUserFile </code><code></code>/etc/httpd/conf<code>/authusers</code><code><br>



















      </code>&nbsp;&nbsp;&nbsp; <code> AuthGroupFile </code><code></code>/etc/httpd/conf<code>/authgroups</code><br>



















&nbsp;&nbsp;&nbsp; <code>
Require group private</code><br>



















#&nbsp;&nbsp;&nbsp; <code>
Require valid-user</code><br>



















      <br>



















&nbsp;&nbsp;&nbsp; Options Indexes FollowSymLinks<br>



















&nbsp;&nbsp;&nbsp; AllowOverride None<br>



















&lt;/Directory&gt;</td>



















    </tr>



















  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>



















<br>



















The <span style="font-family: monospace;">authgroups</span>
file
contains a listing of users that have been placed into logical groups
depending on the areas of access they will be granted. When a users
authorisation is check, the username must correspond to the group name
in the <span style="font-family: monospace;">authgroups</span>
file,
as specified in the "<span style="font-family: monospace;">Require
group private</span>" directive.
Only users alice, bob and jane are
authorised to access the private area.<br>



















<br>



















<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">



















  <tbody>



















    <tr>



















      <td>[bash]# <span style="font-weight: bold;">vi
/etc/httpd/conf</span><code style="font-weight: bold;">/authgroups</code></td>



















    </tr>



















    <tr>



















      <td>private: alice bob jane<br>



















friends: mark linda andrew<br>



















superusers: linda bob<br>



















      </td>



















    </tr>



















  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>



















<br>



















The <span style="font-family: monospace;">authusers</span>
file
contains a listing of usernames and hashed password values which are
checked for authorisation. For a small office or home server, the
directive "<span style="font-family: monospace;">Require
valid-user</span>"
would be more suitable than managing a list of groups and users as it
will match any user in the file.<br>



















<br>



















<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">



















  <tbody>



















    <tr>



















      <td>[bash]# <span style="font-weight: bold;">touch
/etc/httpd/conf</span><code><span style="font-weight: bold;">/authusers</span><br>



















      </code>[bash]# <span style="font-weight: bold;">htpasswd
/etc/httpd/conf</span><code style="font-weight: bold;">/authusers
alice</code><br>



















      <code></code></td>



















    </tr>



















  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>



















<br>



















<table style="width: 100%; text-align: left;" border="1" cellpadding="2" cellspacing="2">



















  <tbody>



















    <tr>



















      <td style="vertical-align: middle; text-align: center; width: 52px;"><img style="width: 24px; height: 24px;" alt="Warning !!" src="images/warning.gif"></td>



















      <td>You should always use
the <span style="font-family: monospace;">touch</span>
command to create a
username/password file, using the wrong command line option (<span style="font-family: monospace;">-c</span>)
will overwrite an existing
file.<br>



















      </td>



















    </tr>



















  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>



















<br>



















<h3>User (public_html)
Authentication</h3>



















General users must manage their authentication slightly differently
because they don't have access to the main configuration file for the
server, this is where the <span style="font-family: monospace;">AccessFileName</span>
(<span style="font-family: monospace;">.htaccess</span>)
directive
comes into play. <br>



















<br>



















The user needs to place a <span style="font-family: monospace;">.htaccess</span>
file into the directory they intend on securing, and then placing the
authorisation directives into the file like in the example.<br>



















<br>



















<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">



















  <tbody>



















    <tr>



















      <td>[bash]$ <span style="font-weight: bold;">vi .htaccess</span><code></code></td>



















    </tr>



















    <tr>



















      <td><code></code><code>AuthType
Basic<br>



















      </code><code>AuthName
"Alice's Private Area"<br>



















      </code><code>AuthUserFile </code><code></code>.ht<code>authusers</code><code><br>



















      </code><code></code>R<code>equire
valid-user</code><br>



















      </td>



















    </tr>



















  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>



















<br>



















The .htauthusers file is now used to contain the username and password
details, so the system can check for authentication.<br>



















<br>



















<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">



















  <tbody>



















    <tr>



















      <td><code></code>[bash]$
      <span style="font-weight: bold;">touch .htauthusers</span><br>



















[bash]$ <span style="font-weight: bold;">htpasswd .htauthusers alice</span><br>



















      <code></code></td>



















    </tr>



















  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>



















<br>



















You should notice the difference in the second example, where the
authorisation directive is now simply "<span style="font-family: monospace;">Require
valid-user</span>", no large
group files are necessary.<br>



















<br>



















If problems occur and the authentication module is not being enforced
for public_html directories, ensure the following directive has been
specified in the main configuration file for public web sites.<br>



















<br>



















<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">



















  <tbody>



















    <tr>



















      <td>AllowOverride AuthConfig<br>



















      </td>



















    </tr>



















  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>



















<br>



















<table style="width: 100%; text-align: left;" border="1" cellpadding="2" cellspacing="2">



















  <tbody>



















    <tr>



















      <td style="vertical-align: middle; text-align: center; width: 52px;"><img style="width: 24px; height: 24px;" alt="Caution !!" src="images/caution.gif"></td>



















      <td>You should be aware
there is a possibility that usernames and
passwords are able to be intercepted during authentication by
malicious users. This can be secured by using encryption techniques
like SSL and TLS.<br>



















      </td>



















    </tr>



















  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>



















<br>



















<h2><a name="vhosts"></a><a href="#top">Virtual
Hosts</a><br>



















</h2>



















Virtual hosting is the ability of a single server to host more than one
website and maintaining the appearance that they are two entirely
different servers. There are two different types of virtual hosting:<br>



















<ul>



















  <li>IP based, where the server
has multiple IP addresses allocated to
it and a corresponding domain name is match against each IP address, and</li>



















  <li>Name based, where the server
has one IP address allocated to it
and several domain names are associated with the one address.</li>



















</ul>



















There are pros and cons about both types, however for a home set up we
are more concerned with a single IP address, so we will cover name
based virtual hosting. Its also the easiest.<br>



















<br>



















When working with virtual hosts, its always a good idea to set up your
own DNS server for testing (if you're not already running one). This
allows you to create your own new domain zone which is internal to your
own network, if everything falls down during development, then the rest
of the Internet will not be effected by any zones that you have
configured. You can also easily add a new
domain zone for each new virtual host you need to test.<br>



















<br>



















The last section of the httpd.conf file is dedicated to virtual
hosting, so lets edit the file and head south.<br>



















<br>



















<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">



















  <tbody>



















    <tr>



















      <td>[bash]# <span style="font-weight: bold;">vi
/etc/httpd/conf/httpd.conf</span> </td>



















    </tr>



















  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>



















<br>



















The following example shows two different domains (example.org and
example.net) being hosted from the main server. Both hosts are using a
separate directory as the <span style="font-family: monospace;">DocumentRoot</span>,
and are also logging to different access and error logs. Including the
servers original domain of example.com, thats now three domains the
server is hosting.<br>



















<br>



















<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">



















  <tbody>



















    <tr>



















      <td><code>NameVirtualHost *:80</code><br>



















      <br>



















#Virtual Host 1 - EXAMPLE.ORG<br>



















&lt;VirtualHost *:80&gt;<br>



















&nbsp;&nbsp;&nbsp; ServerName www.example.org<br>



















&nbsp;&nbsp;&nbsp; ServerAdmin sysadmin@example.org<br>



















&nbsp;&nbsp;&nbsp; DocumentRoot
/var/webhosts/www.example.org<br>



















&nbsp;&nbsp;&nbsp; CustomLog
logs/www.example.org-access_log common<br>



















&nbsp;&nbsp;&nbsp; ErrorLog logs/www.example.org-error_log<br>



















&lt;/VirtualHost&gt;<br>



















      <br>



















#Virtual Host 2 - EXAMPLE.NET<br>



















&lt;VirtualHost *:80&gt;<br>



















&nbsp;&nbsp;&nbsp; ServerName www.example.net<br>



















&nbsp;&nbsp;&nbsp; ServerAdmin sysadmin@example.net<br>



















&nbsp;&nbsp;&nbsp; DocumentRoot
/var/webhosts/www.example.net<br>



















&nbsp;&nbsp;&nbsp; CustomLog
logs/www.example.net-access_log common<br>



















&nbsp;&nbsp;&nbsp; ErrorLog logs/www.example.net-error_log<br>



















&lt;/VirtualHost&gt;<br>



















      <br>



















      </td>



















    </tr>



















  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>



















<br>



















Name based virtual hosting relies on a domain name being passed to the
server when a web page is requested, the server sees the domain name in
the request and
serves the page from the virtual host matching the domain name. The
most important aspect is there must be a valid DNS entry for the
virtual host, otherwise a client won't be able to send the proper
request to the server.<br>



















<br>



















<h2><a name="sslcerts"></a><a href="#top">Using SSL
Certificates</a><br>



















</h2>



















Sending usernames and passwords in cleartext over the Internet risks
the possibility that they may be intercepted, also doing online banking
or other financial transactions using clear text is a major gamble that
your details will be captured. By encrypting our communication so that
only the user and the server are able to access the information, we
stand a far greater chance of ensuring our details will not be
disclosed to some unknown third parties.<br>



















<br>



















The Apache server utilises the Secure Sockets Layer (SSL) to create a
secure link between itself and the connecting web brower, so that any
information being passed is hidden from view. This does not stop any
data from being captured, but it changes the information using
cryptographic algorithms which would take an attacker an awfully long
time to decrypt.<br>



















<br>



















There are a few points you need to be aware of before implementing SSL
certificates:<br>



















<ul>



















  <li>SSL uses Public Key
(asymmetric) Cryptography (there are two keys
- public and private)<br>



















  </li>



















  <li>You need to keep your
private key safe (someone could impersonate
you if they have your key)<br>



















  </li>



















  <li>SSL communicates to the
server through TCP port 443</li>



















  <li>Name based virtual hosts can
not use SSL (only one certificate
for the main site)</li>



















  <li>Some countries do not allow
the use of cryptography (be careful
where you employ it)</li>



















  <li>You need to read MUCH more
than this howto to fully understand SSL<br>



















  </li>



















</ul>



















Apache uses the SSL module which in-turn accesses the OpenSSL libraries
needed to implement the cryptographic mechanisms. Being a module, the
configuration file is located in a separate area from the main
configuration.<br>



















<br>



















<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">



















  <tbody>



















    <tr>



















      <td style="width: 200px;">Configuration
File:<br>



















      </td>



















      <td style="width: 696px;">/etc/httpd/conf.d/ssl.conf</td>



















    </tr>



















  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>



















<br>



















To enable SSL we need to generate an asymmetric key pair. This means
there are two keys generated (public and private) which are
mathematically matched to complement each other; only the public key
can
encrypt/decrypt anything from (or to) the private key, and vice versa.
The private key must be kept secure, while the public key can be given
to anyone that needs it, thats why its called the public key.<br>



















<br>



















Now that we are going to be making cryptographic keys, we need a secure
environment in which to create and store them. The following is
suitable for a home environment.<br>



















<br>



















<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">



















  <tbody>



















    <tr>



















      <td>[bash]# <span style="font-weight: bold;">mkdir
/root/SSL_Certs</span><br>



















[bash]# <span style="font-weight: bold;">chmod 600 /root/SSL_Certs</span><br>



















[bash]# <span style="font-weight: bold;">cd /root/SSL_Certs</span><br>



















      </td>



















    </tr>



















  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>



















<br>



















<br>



















<span style="font-weight: bold;">Step 1:</span> &nbsp; This following
command creates
a private key for the server. It also creates a certificate signing
request file which contains a copy of your public key and some personal
details that identify you and the server.<br>



















<br>



















If your web site is going to be used to offer public services or
e-commerce applications, the digital certificate should be signed by a
proper Certifying Authority (CA). The "certsignreq.csr" file can now be
sent to a CA so it can be signed; there is a fee involved for this
server. The contents of the "certsignreq.csr" file can be read by
anyone (its public information), so copying and pasting the details
into a CAs website is not a security risk.<br>



















<br>



















<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">



















  <tbody>



















    <tr>



















      <td>[bash]# openssl req -newkey rsa:1024 -keyout private.key -out
certsignreq.csr</td>



















    </tr>



















    <tr>



















      <td>Generating a 1024 bit RSA private key<br>



















.....++++++<br>



















.++++++<br>



















writing new private key to 'private.key'<br>



















Enter PEM pass
phrase:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      <span style="color: rgb(255, 0, 0); font-weight: bold;">ENTER
PASSPHRASE HERE</span><span style="color: rgb(255, 0, 0);"></span><br>



















Verifying - Enter PEM pass phrase:&nbsp; <span style="color: rgb(255, 0, 0); font-weight: bold;">ENTER PASSPHRASE HERE</span><br>



















-----<br>



















You are about to be asked to enter information that will be incorporated<br>



















into your certificate request.<br>



















What you are about to enter is what is called a Distinguished Name or a
DN.<br>



















There are quite a few fields but you can leave some blank<br>



















For some fields there will be a default value,<br>



















If you enter '.', the field will be left blank.<br>



















-----<br>



















Country Name (2 letter code) [GB]:<span style="font-weight: bold; color: rgb(255, 0, 0);">AU</span><br>



















State or Province Name (full name) [Berkshire]:<span style="font-weight: bold; color: rgb(255, 0, 0);">QLD</span><br>



















Locality Name (eg, city) [Newbury]:<span style="font-weight: bold; color: rgb(255, 0, 0);">Brisbane</span><br>



















Organization Name (eg, company) [My Company Ltd]:<span style="color: rgb(255, 0, 0); font-weight: bold;">Miles Brennan</span><br>



















Organizational Unit Name (eg, section) []:<span style="font-weight: bold; color: rgb(255, 0, 0);">Home Linux Server</span><br>



















Common Name (eg, your name or your server's hostname) []:<span style="color: rgb(255, 0, 0); font-weight: bold;">www.example.com</span><br>



















Email Address []:<span style="color: rgb(255, 0, 0); font-weight: bold;">sysadmin@example.com</span><br>



















      <br>



















Please enter the following 'extra' attributes<br>



















to be sent with your certificate request<br>



















A challenge password []:<span style="font-weight: bold; color: rgb(255, 0, 0);">secretword</span><br>



















An optional company name []:<br>



















      </td>



















    </tr>



















  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>



















<br>



















<table style="width: 100%; text-align: left;" border="1" cellpadding="2" cellspacing="2">



















  <tbody>



















    <tr>



















      <td style="vertical-align: middle; text-align: center; width: 52px;"><img style="width: 24px; height: 24px;" alt="Caution !!" src="images/caution.gif"></td>



















      <td>The servers name inside
the certificate should be the fully
qualified
hostname that a user is connecting to, otherwise the web browser will
throw the user a warning message. If the servers name is
galaxy.example.com but has an alias to www.example.com which is used
for people to connect, then the certificate should have the name of
www.example.com.<br>



















      </td>



















    </tr>



















  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>



















<br>



















<span style="font-weight: bold;">Step 2:</span> &nbsp; If you intend on
using SSL simply for your own use, and only your friends and family are
going to connect, then you can create your own self-signed digital
certificate for this purpose; you don't need a CA signed cert file.<br>



















<br>



















Using your own self-signed digital certificate causes the browser to
query the certificate when a user connects to the website, the
certificate must be manually accepted before the user can proceed. In
this example we are creating a self-signed certificate with a five year
life (<span style="font-family: monospace;">-days 1825</span>).<br>



















<br>



















<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">



















  <tbody>



















    <tr>



















      <td>[bash]# <span style="font-weight: bold;">openssl rsa -in private.key -out signingkey.key</span><br>



















[bash]# <span style="font-weight: bold;">openssl x509 -in certsignreq.csr -out selfsigned_digicert.crt
-req
-signkey signingkey.key -days 1825</span></td>



















    </tr>



















  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>



















<br>



















<span style="font-weight: bold;">Step 3:</span> &nbsp; The original
private
key that was created used a passphrase to provide it with extra
protection in case someone was to gain physical access to the key file.
When the Apache server starts, it asks for the passphrase for the
private key; this extra precaution stops someone being able to
impersonate your website if they get a copy of your private key.<br>



















<br>



















If the server needs to be restarted and no one is available to enter
the passphrase for the server, then it will simply wait and the server
will not start. This passphrase checking can be removed
using the following sequence of commands, remember to secure the file
so only the root user can access it.<br>



















<br>



















<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">



















  <tbody>



















    <tr>



















      <td>[bash]# <span style="font-weight: bold;">mv private.key private.key.withpassphrase</span><br>



















[bash]# <span style="font-weight: bold;">openssl rsa -in private.key.withpassphrase -out private.key</span><br>



















[bash]# <span style="font-weight: bold;">chmod 0400 private.key</span><br>



















      </td>



















    </tr>



















  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>



















<br>



















<span style="font-weight: bold;">Step 4:</span> &nbsp; After the keys
and
certificate have been prepared, they can be copied across to the
location where the Apache server will load them automatically at
runtime.<br>



















<br>



















<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">



















  <tbody>



















    <tr>



















      <td>
[bash]# <span style="font-weight: bold;">cp private.key /etc/pki/tls/private/localhost.key</span><br>



















[bash]# <span style="font-weight: bold;">cp selfsigned_digicert.crt /etc/pki/tls/certs/localhost.crt</span><br>



















      </td>



















    </tr>



















  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>



















<br>



















<span style="font-weight: bold;">Step 5:</span> &nbsp; If you
configured
your server with a self-signed certificate as a temporary measure, then
the temporary certificate can be easily replaced with the real one when
it is returned from the CA.<br>



















<br>



















<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">



















  <tbody>



















    <tr>



















      <td>[bash]# <span style="font-weight: bold;">cp CAsigned_digicert.crt
/etc/httpd/conf/ssl.crt/server.crt</span></td>



















    </tr>



















  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>



















<br>



















The certificate signing request can be deleted after the CA has
returned your new digital certificate. If your private key file is ever
compromised or lost, you will need to regenerate new keys starting from
step one again.<br>



















<br>



















<h3>Forcing SSL Mode</h3>



















Now that the server is enabled with SSL, all interactions with the
server that deal in usernames, passwords, financial or personal details
can (and should) be sent using the protocol. This is most simply done
by typing <span style="font-family: monospace;">https</span>
in the
address bar instead of <span style="font-family: monospace;">http</span>,
this can also be coded into any webpages to automate the process. But
things go wrong and the little 's' gets forgotten.<br>



















<br>



















The server has another module called "<span style="font-family: monospace;">mod_rewrite</span>"
which allows an
incoming URL request to be rewritten before the server responds with
any web pages. The rewrite module now provides a way to force any
incoming connection request to the SSL protocol, assuming some
predefined criteria like a secure server directory.<br>



















<br>



















<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">



















  <tbody>



















    <tr>



















      <td>[bash]# <span style="font-weight: bold;">vi /etc/httpd/conf.d/mod-rewrite.conf</span> </td>



















    </tr>



















  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>



















<br>



















This small rewrite code can be placed in its own file (so all rewrite
rules can be grouped together), then any request that gets sent to the
"webmail"
folder will be forced into SSL mode and your users can enter their
details in confidentiality. The rewrite log can be used for debugging
if need be.<br>



















<br>



















<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">



















  <tbody>



















    <tr>



















      <td># Rewrite Rules.<br>



















RewriteEngine On<br>



















RewriteCond %{HTTPS} !=on<br>



















RewriteRule ^/webmail/(.*) https://%{SERVER_NAME}/webmail/$1 [R,L]<br>



















      <br>



















#Debug Rewrite Rules<br>



















#RewriteLog /var/log/httpd/rewrite_engine_log<br>



















#RewriteLogLevel 3 </td>



















    </tr>



















  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>



















<br>



















For more information on the rewrite module, refer to the URL Rewriting
Guide in the provided Apache manual: <a href="http://localhost/manual/misc/rewriteguide.html">http://localhost/manual/misc/rewriteguide.html</a><br>



















<br>



















<table style="width: 100%; text-align: left;" border="1" cellpadding="2" cellspacing="2">



















  <tbody>



















    <tr>



















      <td style="vertical-align: middle; text-align: center; width: 52px;"><img style="width: 24px; height: 24px;" alt="Caution !!" src="images/caution.gif"></td>



















      <td> The SSL protocol does
have some CPU overheads, so only use
it where its most practical. Don't force it for the whole server unless
you are providing a particular service to customers.<br>



















      </td>



















    </tr>



















  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>



















<br>



















<h2><a name="webmail"></a><a href="#top">Webmail
Configuration</a><br>



















</h2>



















<span style="font-weight: bold;"></span><a href="http://www.squirrelmail.org">SquirrelMail</a>
is a <a href="http://www.php.net">PHP</a>
based web
application that runs on the Apache server and allows your users the
ability
to log in and read their email from a remote location, its webmail. The
application only supports 'imap' mailboxes and not POP3, so your email
server needs to provide access using imap (POP3 can still be used for
standard mail readers). The dovecot package supports both protocols and
also supports TLS encryption. SquirrelMail has many extra plugin
modules that have been written for it, and its simply a matter of
downloading the plugin and running a configuration script; its that
easy.<br>



















<br>



















The package has two configuration files, one that enables the
application for Apache and another containing the main PHP settings.
The
Apache configuration details an alias that points to the location of
the main SquirrelMail directory, this would be viewed at <span style="font-family: monospace;">http://localhost/webmail</span>.<br>



















<br>



















<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">



















  <tbody>



















    <tr>



















      <td style="width: 175px;">Configuration
File:<br>



















      </td>



















      <td style="width: 721px;">/etc/httpd/conf.d/squirrelmail.conf</td>



















    </tr>



















    <tr>



















      <td colspan="2" rowspan="1">Alias
/webmail /usr/share/squirrelmail<br>



















      </td>



















    </tr>



















  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>



















<br>



















The main PHP configuration file should be backed up before making any
changes.<br>



















<br>



















<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">



















  <tbody>



















    <tr>



















      <td>[bash]# <span style="font-weight: bold;">cp
/etc/squirrelmail/config.php /etc/squirrelmail/config.php.original</span><br>



















[bash]# <span style="font-weight: bold;">vi /etc/squirrelmail/config.php</span><br>



















      </td>



















    </tr>



















  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>



















<br>



















The PHP settings are fairly easy to understand just by looking at them.
You should only need to worry about the domain name (<span style="font-family: monospace;">$domain</span>),
where the imap
mailboxes are located (<span style="font-family: monospace;">$imapServerAddress</span>),
and where to send outgoing emails for processing (<span style="font-family: monospace;">$smtpServerAddress</span>).
If the
webmail application is being run on the email server (like we're
doing), then leave the settings for <span style="font-family: monospace;">localhost</span>.<br>



















<br>



















<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">



















  <tbody>



















    <tr>



















      <td>$domain&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
= 'example.com';<br>



















$imapServerAddress&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; =
'localhost';<br>



















$imapPort&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
= 143; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="font-weight: bold; color: rgb(255, 0, 0);">&lt;-- plain IMAP protocol running on localhost (server)</span><br>



















$useSendmail&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
= true;<br>



















$smtpServerAddress&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; =
'localhost';<br>



















$smtpPort&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
= 25;<br>



















$sendmail_path&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
=
'/usr/sbin/sendmail';<br>



















$pop_before_smtp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
= false;<br>



















$imap_server_type&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
= 'uw';<br>



















      </td>



















    </tr>



















  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>



















<br>



















One of the big queries that always gets asked about any webmail system,
is how to change the size of the file attachments users can send. Then
look no further, this in fact is a PHP setting. You need to change the
setting in the main PHP ini file, and it should be set to the same
value the mail server is configured to accept.<br>



















<br>



















<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">



















  <tbody>



















    <tr>



















      <td>[bash]# <span style="font-weight: bold;">vi /etc/php.ini</span><br>



















      </td>



















    </tr>



















    <tr>



















      <td><span style="font-weight: bold; color: rgb(255, 0, 0);">##&nbsp;NEEDED TO SUPPORT PHP WEBMAIL
LARGE FILE UPLOADS ##</span><br>








      <span style="font-weight: bold;"></span>post_max_size = 50M<br>












upload_max_filesize = 50M<br>












memory_limit = 64M<br>



















      </td>



















    </tr>



















  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>



















<br>



















Your webmail application should now be configured.<br>



















<br>



















<table style="width: 100%; text-align: left;" border="1" cellpadding="2" cellspacing="2">



















  <tbody>



















    <tr>



















      <td style="vertical-align: middle; text-align: center; width: 52px;"><img style="width: 24px; height: 24px;" alt="Caution !!" src="images/caution.gif"></td>



















      <td>If you are accessing webmail from outside your network, use
SSL where possible.<br>



















      </td>



















    </tr>



















  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>



















<br>














If you receive an error from squirrelmail stating "Error connecting to
IMAP server: localhost", it means that IMAP is not running on&nbsp;the
local server using port 143. This is because we only allowed SSL
connections during our mail server configuration (<a href="12-Sendmail_Server.html">Chapter 12</a>), the following
adjustment to Dovecot can be made to allow IMAP on the localhost server.<br>














<br>






This setting only allows insecure (plain) IMAP connections from the
localhost server, which is ideal for webmail access. All other mail
orientated connections are forced to use either IMAPS or POP3S, both
secure protocols.<br>














<br>

























<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">

























  <tbody>

























    <tr>

























      <td><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span>[bash]# <span style="font-weight: bold;">vi /etc/dovecot.conf</span><span style="font-weight: bold;"></span>










      </td>

























    </tr>

























  
  
  
  
  
  
  
  
  
  
  <tr>














      <td><span style="font-weight: bold; color: rgb(255, 0, 0);"></span>protocols = imap imaps pop3s<br>









      <br>









protocol imap {<br>









listen = 127.0.0.1<br>









ssl_listen = *<br>









ssl_disable = no<br>









}</td>














    </tr>














    







  
  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>
























<br>













Once Squirrel Mail has been installed, it can be configured on the
server by using the configuration perl script. This script can be used
to configure the many plugins available for Squirrel Mail, including
the configuration of an LDAP shared address book; conveniently
documented in <a href="20-Shared_Address_Book_LDAP.html">Chapter 20</a>.<br>



















<br>

























<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">

























  <tbody>

























    <tr>

























      <td><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span>










      <span style="font-weight: bold;"></span><span style="font-weight: bold;"></span>[bash]# <span style="font-weight: bold;">cd /usr/share/squirrelmail/config<br>













      </span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span>[bash]# <span style="font-weight: bold;">./conf.pl</span></td>

























    </tr>

























  
  
  
  
  
  
  
  
  
  
  
    
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>
























<br>








<br>



















<hr>
<table style="width: 100%;" border="0" cellpadding="2" cellspacing="2">



















  <tbody>



















    <tr>



















      <td style="width: 30%; text-align: left;"><a href="12-Sendmail_Server.html">Previous</a><br>



















      </td>



















      <td style="width: 40%; text-align: center;"><a href="index.html">Home</a>
      </td>



















      <td style="width: 30%; text-align: right;"><a href="14-FTP_Server.html">Next</a><br>



















      </td>



















    </tr>



















  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>



















</body>
</html>
