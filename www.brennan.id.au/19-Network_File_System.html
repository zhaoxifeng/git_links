<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>










  
  
  
  
  
  
  
  
  
  
  <meta content="text/html; charset=ISO-8859-1" http-equiv="content-type">










  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <title>Linux Home Server HOWTO - Network File System</title>
  <meta content="Miles Brennan" name="author">
</head>


<body>










<div style="text-align: center;"><span style="font-weight: bold;"><a name="top"></a>Linux
Home Server HOWTO</span><br>










</div>










<table style="width: 100%;" border="0" cellpadding="2" cellspacing="2">










  <tbody>










    <tr>










      <td style="width: 30%; text-align: left;"><a href="18-Samba.html">Previous</a><br>










      </td>










      <td style="width: 40%; text-align: center;"><a href="index.html">Home</a>
      </td>










      <td style="width: 30%; text-align: right;"><a href="20-Shared_Address_Book_LDAP.html">Next</a><br>










      </td>










    </tr>










  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>










<hr>
<h1>Chapter 19 - Network File
System</h1>








<table style="text-align: left; width: 100%;" border="0" cellpadding="1" cellspacing="1">









  <tbody>









    <tr>









      <td style="width: 140px;"><span style="font-weight: bold;">Version:</span></td>









      <td>- nfs-utils-1.0.8</td>









    </tr>









  
  
  
  
  
  
  
  
  
  </tbody>
</table>









<span style="font-weight: bold;"></span><br>










<a href="#export">Setting the </a><a href="#export"><span style="color: rgb(255, 0, 0); font-weight: bold;"></span><span style="font-weight: bold;"></span></a><a href="#export">Exports</a><br>










<a href="#starting">Starting and Testing</a><br>










<a href="#setvers">Selecting the Server Version</a><br>










<a href="#import">Imports and Mounting</a><br>










<a href="#nfs4">NFS Version 4</a><br>










<br>










The Network File System (NFS) was originally developed by SUN
Microsystems as a protocol that allowed communications between
different computing environments. The NFS enables a UNIX workstation to
mount an exported share from the server into its own filesystem, thus
giving the user and the client
the appearance that the sub
filesystem belongs to the client; it provides a seamless network mount
point.<br>










<br>










The NFS protocol has been around for a few years now and has undergone
many advancements and revisions. The initial NFS server implementations
only supported UDP packets, while the later versions support stateful
TCP connections; there are pros and cons for using both protocols. NFS
support has been compiled into the Linux kernel now for a while, with
NFS versions 2, 3 (<a href="http://www.ietf.org/rfc/rfc1813.txt">RFC
1813</a>) and 4 (<a href="http://www.ietf.org/rfc/rfc3530.txt">RFC 3530</a>)
being supported by the 2.6 kernel for both UDP and TCP protocols.<br>










<br>










This chapter will describe how to prepare and export shares for users
and workstations from the Linux server, it will also cover the steps
needed for the Linux client to view and mount those exports into its
own filesystem. NFS Versions 2 and 3 are similar in implementation,
while Version 4 is slightly different and detailed further in its own
section.<br>










<br>










The following list of man pages can provide further information to
assist with configuration or debugging requirements.<br>










<br>










<table style="background-color: rgb(220, 220, 220); width: 100%; text-align: left;" border="1" cellpadding="2" cellspacing="2">










  <tbody>










    <tr style="font-family: monospace;">










      <td colspan="2" rowspan="1" style="background-color: rgb(255, 255, 255); font-weight: bold; width: 788px;">Man
Pages:<br>










      </td>










    </tr>










    <tr>










      <td style="background-color: rgb(220, 220, 220); font-family: monospace; width: 120px;">nfs<br>










      </td>










      <td style="background-color: rgb(220, 220, 220); font-family: monospace; width: 788px;">mount</td>










    </tr>










    <tr>










      <td style="background-color: rgb(220, 220, 220); font-family: monospace; width: 120px;">fstab<br>










      </td>










      <td style="background-color: rgb(220, 220, 220); font-family: monospace; width: 788px;">mountd<br>










      </td>










    </tr>










    <tr>










      <td style="font-family: monospace; width: 120px;">exports<br>










      </td>










      <td style="font-family: monospace; width: 788px;">rpcinfo</td>










    </tr>










    <tr>










      <td style="font-family: monospace; width: 120px;">exportfs<br>










      </td>










      <td style="font-family: monospace; width: 788px;">rpc.nfsd</td>










    </tr>










    <tr>










      <td style="font-family: monospace; width: 120px;">portmap</td>










      <td style="font-family: monospace; width: 788px;">rpc.mountd</td>










    </tr>










  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>










<br>










<h2><a name="export"></a><a href="#top">Setting the Exports</a><br>










</h2>










When a user and client workstation connect to an NFS server, the server
firstly checks to ensure that a connection can be established from the
workstation. If the connection is allowed, then the user that is logged
onto the workstation is then authenticated against their account
located on the server to determine if they are an authorised user. If
both checks confirm valid access, then they will be granted their
normal permissions which also include any restrictions placed on the
exported share. The users UID and GID must match between the client and
the server.<br>










<br>










The "/etc/exports" file contains the configuration settings for the
servers exports, it may need to be
created if it does not already exist. The following example displays a
listing of the
exported filesystems and the access restrictions that apply to each
export.<br>










<br>










<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">










  <tbody>










    <tr>










      <td style="width: 876px;" colspan="2" rowspan="1">[bash]# <span style="font-weight: bold;">vi
/etc/exports</span></td>










    </tr>










    <tr>










      <td style="width: 20px;">1.<br>










2.<br>










3.<br>










4.<br>










5.<br>










      </td>










      <td style="width: 876px;">/home&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
linuxwkstn*(rw,sync)<br>










/tmp/fileswap&nbsp;&nbsp;&nbsp;&nbsp; *(rw,no_root_squash,async)<br>










/filestore&nbsp;&nbsp; &nbsp; &nbsp;&nbsp;
192.168.1.0/24(rw,no_root_squash,sync)<br>










/var/ftp &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
192.168.1.0/24(ro,all_squash,async)<br>










/home/alice&nbsp; &nbsp; &nbsp;&nbsp;
admin(rw,all_squash,sync,anonuid=567,anongid=567)<br>










      </td>










    </tr>










  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>










<br>










The following details examine each of the entries which have been
specified in the above exports file.<br>










<br>










<span style="font-weight: bold;">1.</span>&nbsp;&nbsp; The "/home"
directory is accessible from ALL workstations whose hostnames
start with "linuxwkstn". The export has read / write permissions and
the data transfer is synchronous in nature.<br>










<br>










<span style="font-weight: bold;">2.</span>&nbsp;&nbsp; The
"/tmp/fileswap" directory is accessible from ALL workstations
(regardless of name). The export has read / write permissions and data
transfer is
asynchronous. The root account on the local workstation will have root
permission on the remote servers filesystem through the export.<br>










<br>










<span style="font-weight: bold;">3.</span>&nbsp;&nbsp; The "/filestore"
directory is accessible to all hosts in the 192.168.1.0/24 subnet. The
export has read / write permissions and data transfer is synchronous.
The root account on the local workstation will have root
permission on the remote servers filesystem through the export.<br>










<br>










<span style="font-weight: bold;">4.</span>&nbsp;&nbsp; The "/var/ftp"
directory is accessible to all hosts in the 192.168.1.0/24 subnet. The
export is read only, and all connecting users will be forced to connect
as the "nobody" account (squashed). Data transfers are asynchronous.<br>










<br>










<span style="font-weight: bold;">5.</span>&nbsp;&nbsp; Alice's home
directory "/home/alice" is only accessible from the "admin" host
workstation. The export has read / write permissions and data transfers
are synchronous. All connecting users will be forced to connect as the
UID and GID 567. This assumes the account in Alice's name on the server
is UID/GID 567.<br>










<br>










The following are some of the basic exporting options, type "<span style="font-family: monospace;">man exports</span>" to see more
information.<br>










<br>










<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">










  <tbody>










    <tr>










      <td style="width: 100px; font-weight: bold; background-color: rgb(255, 255, 255);">Options:<br>










      </td>










      <td style="width: 796px; font-weight: bold; background-color: rgb(255, 255, 255);">Description:<br>










      </td>










    </tr>










    <tr>










      <td>rw<br>










      </td>










      <td>Allows read and write access to the share<br>










      </td>










    </tr>










    <tr>










      <td>ro<br>










      </td>










      <td>Only allows read access, writing is blocked<br>










      </td>










    </tr>










    <tr>










      <td>all_squash<br>










      </td>










      <td>Forces all connecting users to "nobody" account and
permissions<br>










      </td>










    </tr>










    <tr>










      <td>no_root_squash<br>










      </td>










      <td>Allows root account on client to access export share on
server as the root account<br>










      </td>










    </tr>










    <tr>










      <td>anonuid<br>










      </td>










      <td>Forces all anonymous connections to predefined UID on server </td>










    </tr>










    <tr>










      <td>anongid<br>










      </td>










      <td>Forces all anonymous connections to predefined GID on server </td>










    </tr>










  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>










<br>










After the exports have been defined, the changes need to be passed
through to the NFS mounting daemon (mountd) which stores a list of
available exports in the /var/lib/nfs/etab (or xtab) file. Any
adjustments are added or removed to synchronise the files.<br>










<br>










<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">










  <tbody>










    <tr>










      <td colspan="2" rowspan="1" style="width: 20px;">[bash]# <span style="font-weight: bold;">exportfs
-rv</span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span>









      </td>










    </tr>










    <tr>










      <td style="width: 20px;">1.<br>










2.<br>










3.<br>










4.<br>










5.</td>










      <td style="width: 876px;">exporting linuxwkstn*:/home<br>







exporting *:/tmp/fileswap<br>







exporting 192.168.1.0/24:/filestore<br>







exporting 192.168.1.0/24:/var/ftp<br>







exporting admin.example.com:/home/alice<br>







      </td>







    </tr>







  
  
  
  
  
  
  
  </tbody>
</table>







<br>










<table style="width: 100%; text-align: left;" border="1" cellpadding="2" cellspacing="2">










  <tbody>










    <tr>










      <td style="vertical-align: middle; text-align: center; width: 52px;"><img style="width: 24px; height: 24px;" alt="Caution !!" src="images/caution.gif"></td>










      <td>Both the nfs and portmap services need to be restarted for
new exports to be available to the client.<br>










      </td>










    </tr>










  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>










<br>










<h2><a name="starting"></a><a href="#top">Starting and Testing</a></h2>










The nfs and portmap services should be set and checked for the
appropriate runlevels. The portmap service should already be running on
most standard Linux installations, but its save to check.<br>










<br>










<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">










  <tbody>










    <tr>










      <td>[bash]# <span style="font-weight: bold;">chkconfig --level 345 nfs on</span><br>










[bash]# <span style="font-weight: bold;">chkconfig --level 345 portmap on</span></td>










    </tr>










    <tr>










      <td>[bash]# <span style="font-weight: bold;">chkconfig --list nfs</span><br>










[bash]# <span style="font-weight: bold;">chkconfig --list portmap</span> </td>










    </tr>










  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>










<br>










Although the export settings can be pushed through to the mounting
daemon using the exportfs command, the nfs and portmap initscripts
handle other important functions, so the services should both be
restarted before trying to use the exported filesystem.<br>










<br>










<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">










  <tbody>










    <tr>










      <td>[bash]# <span style="font-weight: bold;">/etc/init.d/nfs restart</span><br>










[bash]# <span style="font-weight: bold;">/etc/init.d/portmap restart</span><br>










      </td>










    </tr>










  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>










<br>










The available list of exports can be seen using the "showmount -e"
command (for local or remote use).<br>










<br>










<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">










  <tbody>










    <tr>










      <td style="width: 876px;" colspan="2" rowspan="1">[bash]#
      <span style="font-weight: bold;">showmount -e galaxy</span></td>










    </tr>










    <tr>










      <td style="width: 20px;"><br>







1.<br>










2.<br>










3.<br>










4.<br>










5.</td>










      <td style="width: 876px;">Export list for galaxy:<br>







/home&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; linuxwkstn*<br>







/tmp/fileswap *<br>







/filestore&nbsp;&nbsp;&nbsp; 192.168.1.0/24<br>







/var/ftp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 192.168.1.0/24<br>







/home/alice&nbsp;&nbsp; admin.example.com<br>







      </td>







    </tr>







  
  
  
  
  
  
  
  </tbody>
</table>







<br>










The system logs should also be checked for any initialisation errors or
events. The system log will normally contain any mounting or
disconnecting calls and should be checked regularly to debug any NFS
connections errors.<br>










<br>










<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">










  <tbody>










    <tr>










      <td>[bash]# <span style="font-weight: bold;">tail -n 50 /var/log/messages</span><br>










      </td>










    </tr>










  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>










<br>










<h2><a name="setvers"></a><a href="#top">Setting the Server Versions</a></h2>










In the chapter's opening, I mentioned that the Linux kernel has
built-in
support for NFS versions 2, 3 and 4. The rpcinfo command can be used to
query the server which will return a listing of RPC details, most
important
are the nfs and mountd entries.<br>










<br>










The following query of the "galaxy" server tells us that it is running
NFS versions 2, 3 and 4 and connections are available using either the
UDP and TCP protocols, it also identifies the server is accepting
connections on
port 2049; the default for NFS.<br>










<br>










The lower part of the query tells us that mountd is accepting
connections for versions 1, 2, and 3 of the NFS protocol, NFSv4 is
handled differently and will be covered later.<br>










<br>










<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">










  <tbody>










    <tr>










      <td style="width: 876px;" colspan="2" rowspan="1">[bash]# <span style="font-weight: bold;">rpcinfo
-p galaxy</span></td>










    </tr>










    <tr>










      <td style="width: 876px;" colspan="2" rowspan="1">&nbsp;&nbsp;
program vers proto&nbsp;&nbsp; port<br>










&nbsp;&nbsp;&nbsp; 100003&nbsp;&nbsp;&nbsp; 2&nbsp;&nbsp;
udp&nbsp;&nbsp; 2049&nbsp; nfs<br>










&nbsp;&nbsp;&nbsp; 100003&nbsp;&nbsp;&nbsp; 3&nbsp;&nbsp;
udp&nbsp;&nbsp; 2049&nbsp; nfs<br>










&nbsp;&nbsp;&nbsp; 100003&nbsp;&nbsp;&nbsp; 4&nbsp;&nbsp;
udp&nbsp;&nbsp; 2049&nbsp; nfs<br>










&nbsp;&nbsp;&nbsp; 100003&nbsp;&nbsp;&nbsp; 2&nbsp;&nbsp;
tcp&nbsp;&nbsp; 2049&nbsp; nfs<br>










&nbsp;&nbsp;&nbsp; 100003&nbsp;&nbsp;&nbsp; 3&nbsp;&nbsp;
tcp&nbsp;&nbsp; 2049&nbsp; nfs<br>










&nbsp;&nbsp;&nbsp; 100003&nbsp;&nbsp;&nbsp; 4&nbsp;&nbsp;
tcp&nbsp;&nbsp; 2049&nbsp; nfs<br>










.<br>










.&nbsp;&nbsp; ### EXCESS REMOVED ###<br>










.<br>










&nbsp;&nbsp;&nbsp; 100005&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp;
udp&nbsp;&nbsp;&nbsp; 997&nbsp; mountd<br>










&nbsp;&nbsp;&nbsp; 100005&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp;
tcp&nbsp;&nbsp; 1000&nbsp; mountd<br>










&nbsp;&nbsp;&nbsp; 100005&nbsp;&nbsp;&nbsp; 2&nbsp;&nbsp;
udp&nbsp;&nbsp;&nbsp; 997&nbsp; mountd<br>










&nbsp;&nbsp;&nbsp; 100005&nbsp;&nbsp;&nbsp; 2&nbsp;&nbsp;
tcp&nbsp;&nbsp; 1000&nbsp; mountd<br>










&nbsp;&nbsp;&nbsp; 100005&nbsp;&nbsp;&nbsp; 3&nbsp;&nbsp;
udp&nbsp;&nbsp;&nbsp; 997&nbsp; mountd<br>










&nbsp;&nbsp;&nbsp; 100005&nbsp;&nbsp;&nbsp; 3&nbsp;&nbsp;
tcp&nbsp;&nbsp; 1000&nbsp; mountd<br>










      </td>










    </tr>










  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>










<br>










The NFS mounting daemon can be configured to ignore calls from clients
that are trying to connect with certain NFS versions. The following
details in the "/etc/sysconfig/nfs" file instructs the mounting daemon
to ignore versions 1 and 2. Type "<span style="font-family: monospace;">man
rpc.mountd</span>" at the command prompt for further details on the
mounting daemon.<br>










<br>










<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">










  <tbody>










    <tr>










      <td style="width: 876px;" colspan="2" rowspan="1">[bash]# <span style="font-weight: bold;">vi
/etc/sysconfig/nfs</span><br>










      </td>










    </tr>










    <tr>










      <td style="width: 876px;" colspan="2" rowspan="1"> <tt>RPCMOUNTDOPTS</tt>=<tt>"-N
1
-N 2"<br>










      </tt> </td>










    </tr>










  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>










<br>










<table style="width: 100%; text-align: left;" border="1" cellpadding="2" cellspacing="2">










  <tbody>










    <tr>










      <td style="vertical-align: middle; text-align: center; width: 52px;"><img style="width: 24px; height: 24px;" alt="Warning !!" src="images/warning.gif"></td>










      <td>When you disable mountd versions 1 and 2, then the <span style="font-weight: bold; font-family: monospace;">"showmount -e galaxy"</span> command will fail with an error similar to: <span style="font-family: monospace; font-weight: bold;">"rpc mount export: RPC: Program/version mismatch; low version = 3, high version = 3"</span>. This can be alleviated by leaving all NFS versions running on the server and then forcing <span style="font-weight: bold; font-family: monospace;">"nfsvers=3"</span> in your <span style="font-weight: bold; font-family: monospace;">"/etc/fstab"</span> file on the remote client.<br>










      </td>










    </tr>










  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>









<br>










This is the "rpcinfo" output after making the above changes (nfs
daemon not displayed).<br>










<br>










<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">










  <tbody>










    <tr>










      <td style="width: 876px;" colspan="2" rowspan="1">[bash]# <span style="font-weight: bold;">rpcinfo
-p galaxy</span></td>










    </tr>










    <tr>










      <td style="width: 876px;" colspan="2" rowspan="1">&nbsp;&nbsp;
program vers proto&nbsp;&nbsp; port<br>










.<br>










.&nbsp;&nbsp; ### EXCESS REMOVED ###<br>










.<br>










&nbsp;&nbsp;&nbsp; 100005&nbsp;&nbsp;&nbsp; 3&nbsp;&nbsp;
udp&nbsp;&nbsp;&nbsp; 997&nbsp; mountd<br>










&nbsp;&nbsp;&nbsp; 100005&nbsp;&nbsp;&nbsp; 3&nbsp;&nbsp;
tcp&nbsp;&nbsp; 1000&nbsp; mountd<br>










      </td>










    </tr>










  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>










<br>










<table style="width: 100%; text-align: left;" border="1" cellpadding="2" cellspacing="2">










  <tbody>










    <tr>










      <td style="vertical-align: middle; text-align: center; width: 52px;"><img style="width: 24px; height: 24px;" alt="Caution !!" src="images/caution.gif"></td>










      <td>If you intend running NFSv4, then mountd must at least handle
support for version 3; you can not disable all versions.<br>










      </td>










    </tr>










  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>










<br>










<h2><a name="import"></a><a href="#top">Imports and Mounting</a><br>










</h2>










Now that the server has been configured with the exported filesystem,
the Linux workstations need to be configured so they can connect to the
remote resources for mounting. The portmap service handles the call
between the client and server, so the service should be running; the
portmap service should already be active in a standard installation.<br>










<br>










The rcpinfo command can be used on the Linux client to confirm that
portmap service is running.<br>










<br>










<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">










  <tbody>










    <tr>










      <td style="width: 876px;" colspan="2" rowspan="1">[bash]# <span style="font-weight: bold;">rpcinfo
-p linuxwkstn01</span></td>










    </tr>










    <tr>










      <td style="width: 876px;" colspan="2" rowspan="1">&nbsp;&nbsp;
program vers proto&nbsp;&nbsp; port<br>










&nbsp;&nbsp;&nbsp; 100000&nbsp;&nbsp;&nbsp; 2&nbsp;&nbsp;
tcp&nbsp;&nbsp;&nbsp; 111&nbsp; portmapper<br>










&nbsp;&nbsp;&nbsp; 100000&nbsp;&nbsp;&nbsp; 2&nbsp;&nbsp;
udp&nbsp;&nbsp;&nbsp; 111&nbsp; portmapper<br>










      </td>










    </tr>










  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>










<br>










Now that the portmap service is running, the "<span style="font-family: monospace;">showmount -e galaxy</span>" command
can be executed on the client to query the server for any available
exported resources.<br>










<br>










<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">










  <tbody>










    <tr>










      <td style="width: 876px;" colspan="2" rowspan="1">[bash]#
      <span style="font-weight: bold;">showmount -e galaxy</span></td>










    </tr>










  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>










<br>










The exports that have been made available on the server need to be
mounted on the client, this occurs in the same fashion that your
partitions are mounted throughout the rest of your filesystem; with the
use of mount points.<br>










<br>










The workstation needs to have the mount point directories prepared for
the exports to connect, creating the directories as required.<br>










<br>










<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">










  <tbody>










    <tr>










      <td>[bash]# <span style="font-weight: bold;">mkdir /shared</span><br>










[bash]# <span style="font-weight: bold;">mkdir /workfiles</span><br>










[bash]# <span style="font-weight: bold;">mkdir /media/ftp</span><br>










[bash]# <span style="font-weight: bold;">mkdir /media/alice</span><br>










      </td>










    </tr>










  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>










<br>










The file system table (fstab) is a configuration file that details the
static mounting details and different types of the filesystems that are
configured on the host computer. The configurations may also specify
any additional mounting options that should be associated with each
entry.<br>










<br>










The following entries in fstab list the mounting details for the local
workstation that where declared earlier on the NFS server. The
filesystem type
declared is "nfs" which handles versions 2 and 3 of the protocol. The
default version (depending on the server) is version 2, so the entries
labeled 2 and 5 below have explicitly defined they are connecting to
the server
using version 3 (nfsvers=3).<br>










<br>










<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">










  <tbody>










    <tr>










      <td colspan="2" rowspan="1" style="width: 20px;">[bash]# <span style="font-weight: bold;">cp
/etc/fstab /etc/fstab.original</span><br>










[bash]# <span style="font-weight: bold;">vi /etc/fstab</span><br>










      </td>










    </tr>










    <tr>










      <td style="width: 20px;">1.<br>










2.<br>










3.<br>










4.<br>










5.<br>










      </td>










      <td style="width: 863px;">galaxy:/home&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp; &nbsp;
/home&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
nfs&nbsp;&nbsp;&nbsp; defaults 0 0<br>










galaxy:/tmp/fileswap&nbsp;
/shared&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; nfs&nbsp;&nbsp;&nbsp;
defaults,nfsvers=3,tcp 0 0<br>










galaxy:/filestore &nbsp;&nbsp;&nbsp; /workfiles &nbsp; &nbsp;
nfs&nbsp;&nbsp;&nbsp; defaults,rsize=8192,wsize=8192 0 0<br>










galaxy:/var/ftp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /media/ftp&nbsp;
&nbsp;&nbsp; nfs&nbsp;&nbsp;&nbsp; sync,auto,ro,noexec,hard,intr 0 0<br>










galaxy:/home/alice&nbsp;&nbsp;&nbsp; /media/alice&nbsp;&nbsp;
nfs&nbsp;&nbsp;&nbsp;
defaults,nfsvers=3,tcp,retry=30,rsize=8192,wsize=8192 0 0<br>










      </td>










    </tr>










  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>










<br>










Now that the file system table has been populated with the details
needed to connect to the server, the connections can be made by calling
the "mount" command. This example says activate the "/workfiles" mount
point specified in the fstab file, which is line 3. Because all the
relevant details are located in the file, the system will just mount it
automatically.<br>










<br>










<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">










  <tbody>










    <tr>










      <td>[bash]# <span style="font-weight: bold;">mount /workfiles</span><br>










      </td>










    </tr>










  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>










<br>










All of the connections can also be made at the same time by specifying
the all (<span style="font-family: monospace;">-a</span>) option, and
defining all the nfs types (<span style="font-family: monospace;">-t</span>).
This is a quick command for mounting all the nfs connections at once.<br>










<br>










<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">










  <tbody>










    <tr>










      <td>[bash]# <span style="font-weight: bold;">mount -a -t nfs</span><br>










      </td>










    </tr>










  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>










<br>










After the connection has been established, a directory listing reveals
the directories located on the remote server. It appears seamless to
the user
and client workstation.<br>










<br>










<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">










  <tbody>










    <tr>










      <td>[bash]# <span style="font-weight: bold;">ls -l /workfiles</span><br>










      </td>










    </tr>










    <tr>










      <td>drwxrwx---&nbsp; 4 root financial&nbsp; 4096 Jan&nbsp; 1
06:07 financial<br>










drwxrwx---&nbsp; 3 root adminstaff 4096 Jan&nbsp; 1 06:07 adminstaff<br>










drwxrwxrwx&nbsp; 4 root root &nbsp; &nbsp; &nbsp; 4096 Jan&nbsp; 1
06:07 shared </td>










    </tr>










  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>










<br>










The connections can also be typed manually on the command line using
the
following example.<br>










<br>










<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">










  <tbody>










    <tr>










      <td>[bash]# <span style="font-weight: bold;">mount -t nfs galaxy:/var/ftp /tmp/ftp -o
ro,sync,auto,hard,intr</span><br>










      </td>










    </tr>










  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>










<br>










To see which connections have been established, the full mount listing
can be displayed.<br>










<br>










<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">










  <tbody>










    <tr>










      <td>[bash]# <span style="font-weight: bold;">mount -l</span><br>










      </td>










    </tr>










  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>










<br>










To disconnect the remote connection, the unmount command can be issued
specifying the connection point (mount point).<br>










<br>










<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">










  <tbody>










    <tr>










      <td>[bash]# <span style="font-weight: bold;">umount /media/ftp</span><br>










[bash]# <span style="font-weight: bold;">umount /workfiles</span><br>










      </td>










    </tr>










  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>










<br>










If the connections are configured correctly but appear to be
problematic, then restarting the portmap service can normally assist;
though this is rare.<br>










<br>










<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">










  <tbody>










    <tr>










      <td>[bash]# <span style="font-weight: bold;">/etc/init.d/portmap restart</span><br>










      </td>










    </tr>










  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>










<br>










<h2><a name="nfs4"></a><a href="#top">NFS Version 4</a><br>



</h2>





<table style="text-align: left; width: 100%;" border="0" cellpadding="1" cellspacing="1">









  <tbody>









    <tr>









      <td style="width: 140px;"><span style="font-weight: bold;">Version:</span></td>









      <td>- kernel 2.6</td>









    </tr>









  
  
  
  
  
  
  
  
  
  </tbody>
</table>









<span style="font-weight: bold;"></span><a href="19-Network_File_System.html#export"></a><br>










Version 4 of the NFS brings a new range of advancements to the
networking protocol, with access control lists, sophisticated security
mechanisms, and better interoperability with firewall and NAT
applications to name a few. To the average user the main difference
will be in the configuration and its implementation.<br>



<br>










<h3>Are You NFS4 Ready</h3>










If you are using a standard installed Linux distribution, you can
easily check to see if it supports version 4. Assuming the nfs service
is running on the server, the following "rcpinfo" command can be issued
which returns the version numbers and protocols supported by the
servers kernel; in this case version 4 is supported with both UDP and
TCP (other versions have been removed from the display).<br>










<br>










<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">










  <tbody>










    <tr>










      <td style="width: 876px;" colspan="2" rowspan="1">[bash]# <span style="font-weight: bold;">rpcinfo
-p galaxy</span></td>










    </tr>










    <tr>










      <td style="width: 876px;" colspan="2" rowspan="1">&nbsp;&nbsp;
program vers proto&nbsp;&nbsp; port<br>










&nbsp;&nbsp;&nbsp; 100003&nbsp;&nbsp;&nbsp; 4&nbsp;&nbsp;
udp&nbsp;&nbsp; 2049&nbsp; nfs<br>










&nbsp;&nbsp;&nbsp; 100003&nbsp;&nbsp;&nbsp; 4&nbsp;&nbsp;
tcp&nbsp;&nbsp; 2049&nbsp; nfs<br>










.<br>










.&nbsp;&nbsp; ### EXCESS REMOVED ###<br>










      </td>










    </tr>










  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>










<br>










On the server the following mount command displays the running nfs
daemon and also the ID to name mapping daemon (new to version 4).<br>










<br>










<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">










  <tbody>










    <tr>










      <td><span style="color: rgb(255, 0, 0); font-weight: bold;">###
ON THE SERVER ###</span><br>










[bash]# <span style="font-weight: bold;">mount -l</span><br>










      </td>










    </tr>










    <tr>










      <td>
      
      
      
      
      
      
      
      
      sunrpc on /var/lib/nfs/rpc_pipefs type rpc_pipefs (rw)<br>

nfsd on /proc/fs/nfsd type nfsd (rw)<br>










      </td>










    </tr>










  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>










<br>










On the client the ID to name mapping daemon must also be present.<br>










<br>










<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">










  <tbody>










    <tr>










      <td><span style="color: rgb(255, 0, 0); font-weight: bold;">###
ON THE CLIENT ###</span><br>










[bash]# <span style="font-weight: bold;">mount -l</span><br>










      </td>










    </tr>










    <tr>










      <td>
      
      
      
      
      
      
      
      
      sunrpc on /var/lib/nfs/rpc_pipefs type rpc_pipefs (rw)<br>










      </td>










    </tr>










  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>










<br>










Assuming these small checks are satisfied, your systems should be
capable of implementing NFSv4.<br>










<br>










<h3>Preparing The Server</h3>










The earlier versions (2 and 3) of NFS map anonymous users to the nobody
account on the server. Depending on your distribution it may already
have an
account that is configured specifically for NFS anonymous access, in
this
case the "nfsnobody" account. If not, leave the default as the standard
"nobody" account.<br>










<br>










<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">










  <tbody>










    <tr>










      <td>[bash]# <span style="font-weight: bold;">grep nfs /etc/passwd</span><br>










      </td>










    </tr>










    <tr>










      <td><span style="font-weight: bold;">nfsnobody</span>:x:<span style="font-weight: bold;">65534</span>:<span style="font-weight: bold;">65534</span>:Anonymous NFS
User:/var/lib/nfs:/sbin/nologin<br>










      </td>










    </tr>










  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>










<br>










The ID to name mapping daemon is a new enhancement to the NFSv4
protocol, it passes usernames between the client and server after
mapping them from (and back to) UID and GID.<br>










<br>










<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">










  <tbody>










    <tr>










      <td>[bash]# <span style="font-weight: bold;">vi /etc/idmapd.conf</span><br>










      </td>










    </tr>










    <tr>










      <td>[General]<br>










Verbosity = 0<br>










Pipefs-Directory = /var/lib/nfs/rpc_pipefs<br>










Domain = example.com<br>










      <br>










[Mapping]<br>










Nobody-User = <span style="font-weight: bold;">nfsnobody</span><br>










Nobody-Group = <span style="font-weight: bold;">nfsnobody</span><br>










      <br>










[Translation]<br>










Method = nsswitch<br>










      </td>










    </tr>










  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>










<br>










The ID name mapping settings that are defined on the server also need
to be
replicated to the client workstations.<br>










<br>










<h3>Setting Up The Server</h3>










The exports for an NFSv4 server are handled very much differently to
the earlier versions of the protocol. For a version 4 server, all of
the exports are handled through one export point (the
pseudofilesystem), with all other exports grouped underneath the master
export. Sounds confusing? All of the exports must be put into the one
master directory, even if the original directories are located
elsewhere in the filesystem.<br>










<br>










In our example below, we are going to export several sections of the
servers filesystem, however we need to create a master export point
(pseudofilesystem), then place all of the exports we intend to share
into that one master directory, then we export everything.<br>










<br>










The "/NFS4exports" directory will hold all of our local filesystem
resources that will be made available as exports, the three sub
directories are the actual exported resources which need to be mapped
back to the real resources.<br>










<br>










<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">










  <tbody>










    <tr>










      <td>[bash]# <span style="font-weight: bold;">mkdir /NFS4exports</span></td>










    </tr>










    <tr>










      <td>[bash]# <span style="font-weight: bold;">mkdir /NFS4exports/ftp</span><br>










[bash]# <span style="font-weight: bold;">mkdir /NFS4exports/home</span><br>










[bash]# <span style="font-weight: bold;">mkdir /NFS4exports/filestore</span><br>










      </td>










    </tr>










  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>










<br>










The "/NFS4exports" directory and other three sub directories are empty
so we need to create the links to the actual areas we are exporting.<br>










<br>










Using mount and the fstab file, we are able to "bind" one section of
the filesystem to another. This works similar in functionality to a
symbolic link, however it is configured as a bind and the files are
fully accessible in both sections of the filesystem, not just linked to
the original location.<br>










<br>










The following configuration is bind mounting the original directories
(left) into the main "/NFS4exports" directory. Note the filesystem type
is defined as "none" and the only options defined is the "bind" method.<br>










<br>










<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">










  <tbody>










    <tr>










      <td>[bash]# <span style="font-weight: bold;">vi /etc/fstab</span><br>










      </td>










    </tr>










    <tr>










      <td>
      
      
      
      
      
      
      
      
      ## BIND Mounting The Filesystem ##<br>

/var/ftp &nbsp; &nbsp; &nbsp; &nbsp; /NFS4exports/ftp &nbsp; &nbsp; &nbsp; &nbsp;	none	&nbsp; &nbsp; bind &nbsp;&nbsp; 0 0<br>

/home &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; /NFS4exports/home &nbsp;
&nbsp; &nbsp; &nbsp;none &nbsp; &nbsp; bind &nbsp; &nbsp;0 0<br>

/filestore &nbsp; &nbsp; &nbsp;	/NFS4exports/filestore	&nbsp; none	&nbsp; &nbsp; bind &nbsp; &nbsp;0 0








      </td>










    </tr>










  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>










<br>










After the fstab file has been configured, the mounts can be binded
using the following command.<br>










<br>










<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">










  <tbody>










    <tr>










      <td>[bash]# <span style="font-weight: bold;">mount -a -t none</span><br>










      </td>










    </tr>










  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>










<br>










The active mounts can be checked to confirm the successful mounting of
the bind directories. At this point the filesystems have two access
points to the same locations, this should not be confused with a
symbolic link (although it is similar in understanding).<br>










<br>










<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">










  <tbody>










    <tr>










      <td>[bash]# <span style="font-weight: bold;">mount -l | grep bind</span></td>










    </tr>










    <tr>










      <td>/var/ftp on /NFS4exports/ftp type none (rw,bind)<br>










/home on /NFS4exports/home type none (rw,bind)<br>










/filestore on /NFS4exports/filestore type none (rw,bind)<br>










      </td>










    </tr>










  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>










<br>










Doing a directory listing of the "/NFS4exports/ftp" directory displays
the "pub" directory that is actually located in "/var/ftp". This
indicates a successful bind.<br>










<br>










<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">










  <tbody>










    <tr>










      <td>[bash]# <span style="font-weight: bold;">ls -l /NFS4exports/ftp</span><br>










      </td>










    </tr>










    <tr>










      <td>drwxr-xr-x&nbsp; 3 root root 4096 Dec&nbsp; 9 15:49 pub<br>










      </td>










    </tr>










  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>










<br>










The exports can now be defined for the server, similar to the examples
for version 2 and 3. Be sure to check the nfs man page for NFSv4
specific export options. Type "<span style="font-family: monospace;">man
nfs</span>" at the command prompt.<br>










<br>










The most important configuration setting here is the "<span style="font-weight: bold; font-family: monospace;">fsid=0</span>"
option
which tells the server that this is the pseudofilesystem and that all
other directories are contained within this one. Another important
setting here is the anonuid and anongid values, they are set to 65534
which is the nfsbody account we identified earlier (if it exists,
otherwise nobody account).<br>










<br>










<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">










  <tbody>










    <tr>










      <td>[bash]# <span style="font-weight: bold;">vi /etc/exports</span><br>










      </td>










    </tr>










    <tr>










      <td>
      
      
      
      
      
      
      
      
      /NFS4exports
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp;192.168.1.0/24(rw,insecure,sync,wdelay,no_subtree_check,no_root_squash,<span style="font-weight: bold;">fsid=0</span>)<br>

/NFS4exports/ftp &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;
192.168.1.0/24(ro,insecure,sync,wdelay,no_subtree_check,nohide,all_squash,anonuid=<span style="font-weight: bold;">65534</span>,anongid=<span style="font-weight: bold;">65534</span>)<br>

/NFS4exports/filestore &nbsp; &nbsp;&nbsp;   192.168.1.0/24(rw,insecure,sync,wdelay,no_subtree_check,nohide,no_root_squash)<br>

/NFS4exports/home &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
192.168.1.0/24(rw,insecure,sync,wdelay,no_subtree_check,nohide,no_root_squash)<br>










      </td>










    </tr>










  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>










<br>










<h3>Starting and Testing</h3>










As with the normal configuration, the services need to be configured at
the appropriate runlevels and checked.<br>










<br>










<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">










  <tbody>










    <tr>










      <td>[bash]# <span style="font-weight: bold;">chkconfig --level 345 nfs on</span><br>










[bash]# <span style="font-weight: bold;">chkconfig --level 345 portmap on</span></td>










    </tr>










    <tr>










      <td>[bash]# <span style="font-weight: bold;">chkconfig --list nfs</span><br>










[bash]# <span style="font-weight: bold;">chkconfig --list portmap</span> </td>










    </tr>










  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>










<br>










The services should be restarted.<br>










<br>










<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">










  <tbody>










    <tr>










      <td>[bash]# <span style="font-weight: bold;">/etc/init.d/nfs restart</span><br>










[bash]# <span style="font-weight: bold;">/etc/init.d/portmap restart</span><br>










      </td>










    </tr>










  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>










<br>










The exports that are available from the server can be checked with the
following commands.<br>










<br>










<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">










  <tbody>










    <tr>










      <td>[bash]# <span style="font-weight: bold;">exportfs -v</span><br>










[bash]# <span style="font-weight: bold;">showmount -e localhost</span><br>










      </td>










    </tr>










  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>










<br>










<h3>Setting Up The Client</h3>










Before the client can be configured, we need to confirm the exports can
be seen and are accessible to the client workstation. The following
output displays the psuedofilesystem and the three subordinate exports.<br>










<br>










<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">










  <tbody>










    <tr>










      <td>[bash]# <span style="font-weight: bold;">showmount -e galaxy</span><br>










      </td>










    </tr>










    <tr>










      <td>Export list for galaxy:<br>










/NFS4exports&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
192.168.1.0/24<br>










/NFS4exports/ftp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 192.168.1.0/24<br>










/NFS4exports/home&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 192.168.1.0/24<br>










/NFS4exports/filestore 192.168.1.0/24<br>










      </td>










    </tr>










  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>










<br>










Similar to the servers earlier configuration, the client also needs to
be configured with the ID to name mapping daemon. These settings should
be the same as earlier defined on the server.<br>










<br>










<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">










  <tbody>










    <tr>










      <td>[bash]#<span style="font-weight: bold;"> vi /etc/idmapd.conf</span><br>










      </td>










    </tr>










    <tr>










      <td>[General]<br>










Verbosity = 0<br>










Pipefs-Directory = /var/lib/nfs/rpc_pipefs<br>










Domain = example.com<br>










      <br>










[Mapping]<br>










Nobody-User = <span style="font-weight: bold;">nfsnobody</span><br>










Nobody-Group = <span style="font-weight: bold;">nfsnobody</span><br>










      <br>










[Translation]<br>










Method = nsswitch<br>










      </td>










    </tr>










  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>










<br>










The major difference for the NFSv4 client is the way the export is
going to be mounted. All of the shares are located under one main
export; the
pseudofilesystem which is the only one that needs to be mounted.<br>










<br>










We now need to create the mount point for our connection.<br>










<br>










<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">










  <tbody>










    <tr>










      <td>[bash]# <span style="font-weight: bold;">mkdir /media/galaxy</span> </td>










    </tr>










  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>










<br>










The client needs to detail the mounting configurations and options in
the fstab file. The noticeable difference below is the explicit setting
for "<span style="font-weight: bold;">nfs4</span>", if this is missed
then the client will attempt to connect
with an earlier NFS version.<br>










<br>










All of the exports on the server are located under "/NFS4exports",
however when the connection is made, the configuration needs to specify
the root connection of "galaxy:/" and not "galaxy:/NFS4exports". Using
the "/" (root) mount instructs the client to connect to the
pseudofilesystem which was earlier configured on the server with the
"fsid=0"
option.<br>










<br>










<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">










  <tbody>










    <tr>










      <td>[bash]# <span style="font-weight: bold;">vi /etc/fstab</span></td>










    </tr>










    <tr>










      <td>
      
      
      
      
      
      
      
      
      <span style="font-weight: bold;">galaxy:/</span>    /media/galaxy    <span style="font-weight: bold;">nfs4</span>    auto,rw,nodev,sync,_netdev,proto=tcp,retry=10,rsize=32768,wsize=32768,hard,intr 0 0








      </td>










    </tr>










  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>










<br>










<table style="width: 100%; text-align: left;" border="1" cellpadding="2" cellspacing="2">










  <tbody>










    <tr>










      <td style="vertical-align: middle; text-align: center; width: 52px;"><img style="width: 24px; height: 24px;" alt="Note !!" src="images/note.gif"></td>










      <td>The mounting options for NFSv4 are different to earlier
versions, type "<span style="font-family: monospace;">man nfs</span>"
at the command prompt to see the options available for all versions.<br>










      </td>










    </tr>










  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>










<br>










Now that the connection is configured on the client, the mount can be
established with the following command.<br>










<br>










<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">










  <tbody>










    <tr>










      <td>[bash]# <span style="font-weight: bold;">mount /media/galaxy</span> </td>










    </tr>










  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>










<br>










The mount can also be detailed and connected manually by typing a
similar command at the prompt.<br>










<br>










<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">










  <tbody>










    <tr>










      <td>[bash]# <span style="font-weight: bold;">mount -t nfs4 192.168.1.11:/ /mnt/testing \</span><br style="font-weight: bold;">







      <span style="font-weight: bold;">


&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -o
async,auto,exec,_netdev,nodev,rw,retry=5,rsize=32768,wsize=32768,proto=tcp,hard,intr</span><br>










      </td>










    </tr>










  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>










<br>










A listing of the mounted filesystem determines whether the connection
was successful.<br>










<br>










<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">










  <tbody>










    <tr>










      <td>[bash]# <span style="font-weight: bold;">mount -l</span><br>










      </td>










    </tr>










    <tr>










      <td><span style="font-weight: bold;">galaxy:/</span> on
/mnt/galaxy type <span style="font-weight: bold;">nfs4</span>
(rw,addr=galaxy)<br>










      </td>










    </tr>










  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>










<br>










Doing a directory listing of the mounted filesystem on the local client
returns all of the subordinate mounts on the remote server.<br>










<br>










<table style="width: 100%; background-color: rgb(220, 220, 220); text-align: left; font-family: monospace;" border="1" cellpadding="5" cellspacing="2">










  <tbody>










    <tr>










      <td>[bash]# <span style="font-weight: bold;">ls -l /media/galaxy</span></td>










    </tr>










    <tr>










      <td>drwxr-xr-x&nbsp; 4 root root 4096 Jan&nbsp; 1 06:07 filestore<br>










drwxr-xr-x&nbsp; 3 root root 4096 Jan&nbsp; 1 06:07 ftp<br>










drwxr-xr-x&nbsp; 4 root root 4096 Jan&nbsp; 1 06:07 home<br>










      </td>










    </tr>










  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>










<br>










The systems are now all configured with the NFSv4 protocol.<br>










<br>










<br>










<hr>
<table style="width: 100%;" border="0" cellpadding="2" cellspacing="2">










  <tbody>










    <tr>










      <td style="width: 30%; text-align: left;"><a href="18-Samba.html">Previous</a><br>










      </td>










      <td style="width: 40%; text-align: center;"><a href="index.html">Home</a>
      </td>










      <td style="width: 30%; text-align: right;"><a href="20-Shared_Address_Book_LDAP.html">Next</a><br>










      </td>










    </tr>










  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>










</body>
</html>
